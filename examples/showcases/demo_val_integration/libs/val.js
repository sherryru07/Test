define("config",[],function(){var e=0,t=1,n=2,r=3,i=750,s="cubic-in-out",o=n,u=i,a=s;return{transition:{none:e,low:t,high:n,veryhigh:r,defaultEasing:s,allowsLowDetail:function(){return o>=t},allowsHighDetail:function(){return o>=n},allowsVeryHighDetail:function(){return o>=r},detail:function(e){return e===undefined?o:(o=e,this)},duration:function(e){return e===undefined?u:(u=e,this)},easing:function(e){return e===undefined?a:(a=e,this)}}}}),define("coordinates/base",[],function(){return function(e){e=e||{};var t={};return e.scaleX=null,e.scaleY=null,e.isQuantitative=function(e){return e&&e.type==="quantitative"},e.isCategorical=function(e){return e&&(e.type==="nominal"||e.type==="ordinal")},e.isOrdinal=function(e){return e&&e.type==="ordinal"},e.isNominal=function(e){return e&&e.type==="nominal"},e.isQxQ=function(t,n){return e.isQuantitative(t)&&e.isQuantitative(n)},t.scaleX=function(n){return arguments.length?(e.scaleX=n,t):e.scaleX},t.scaleY=function(n){return arguments.length?(e.scaleY=n,t):e.scaleY},t}}),define("coordinates/polar",["./base"],function(e){return function(){var t=-Math.PI/2,n={},r=e(n);return n.center=[0,0],r.type="polar",r.scaleRadius=r.scaleX,r.scaleAngle=r.scaleY,r.center=function(e){return arguments.length?(n.center=e,r):{x:n.center[0],y:n.center[1]}},r.radius=function(e){return r.scaleRadius()(e)+r.scaleRadius().rangeBand()*.5},r.angle=function(e){return r.scaleAngle()(e)},r.position=function(e,i){var s,o;arguments.length===1&&e[0]!==undefined&&e[1]!==undefined?(s=r.radius(e[0]),o=r.angle(e[1])):(s=e,o=i);var u=s*Math.cos(o+t)+n.center[0],a=s*Math.sin(o+t)+n.center[1];return{x:u,y:a}},r}}),define("coordinates/rectangular",["./base"],function(e){return function(){var t={},n=e(t);return n.type="rectangular",n.position=function(e){var n=(e[0]!==undefined?t.scaleX(e[0]):0)+(t.isCategorical(t.scaleX)?t.scaleX.rangeBand()/2:0),r=(e[1]!==undefined?t.scaleY(e[1]):0)+(t.isCategorical(t.scaleY)?t.scaleY.rangeBand()/2:0);return{x:n,y:r}},n}}),define("coordinates",["./coordinates/polar","./coordinates/rectangular"],function(e,t){return{polar:e,rectangular:t}}),define("data/datapointSpec",[],function(){return{id:"id",x:"x",y:"y",z:"z",value:"value",seriesKey:"seriesKey",color:"color",size:"size",opacity:"opacity",label:"label",borderColor:"borderColor",borderWidth:"borderWidth"}}),define("data/specMapper",[],function(){var e=function(e,t){return t};return{reify:function(t,n,r){var i={};return Object.keys(r).forEach(function(e){i[e]=""}),Object.keys(t).forEach(function(e){i[e]=t[e]}),i.id||(i.id=e),n.map(function(e,t){var n={};return Object.keys(i).forEach(function(r){var s=i[r];typeof s=="function"?n[r]=s(e,t):typeof e[s]=="function"?n[r]=e[s]():n[r]=e[s]}),n})}}}),define("utility/aggregate",{domainGroupSumSplitNegatives:function(e,t,n){var r=this;n=n||(t==="x"?"y":"x");var i=0,s=0;return d3.nest().key(function(e){return n==="none"?"":n==="quadrants"?(e.x>=0?"+":"-")+(e.y>=0?"+":"-"):n==="x"?e.x:e.y}).rollup(function(e){var n=r.sum(e.filter(function(e){return e[t]>0}),t),o=r.sum(e.filter(function(e){return e[t]<0}),t);i=Math.min(o,i),s=Math.max(n,s)}).entries(e),[i,s]},domainGroupSum:function(e,t,n){var r=this;n=n||(t==="x"?"y":"x");var i=[Infinity,-Infinity];return d3.nest().key(function(e){return n==="none"?"":n==="x"?e.x:e.y}).rollup(function(e){var n=r.sum(e,t);i=[Math.min(i[0],n),Math.max(i[1],n)]}).entries(e),i},sum:function(e,t){return e.reduce(function(e,n){return t==="x"?e+n.x:e+n.y},0)}}),define("utility/order",{sizeComparator:function(e,t){return e=e.size,t=t.size,e===undefined||t===undefined?0:t-e},valueComparator:function(e,t){e=e.value,t=t.value;if(e===t)return 0;if(e>t)return 1;if(t>e)return-1},positionAndSizeComparator:function(e,t){var n=e.y,r=e.x,i=t.y,s=t.x;if(n===undefined||i===undefined||n===i){if(r===undefined||s===undefined||r===s){var o=e.size,u=t.size;return o===undefined||u===undefined?0:u-o}return Math.abs(s)-Math.abs(r)}return Math.abs(i)-Math.abs(n)}}),define("utility/selection",{countNodes:function(e){var t=0;return e.forEach(function(e){t+=e.length}),t},findContainingGroup:function(e,t){var n=null;return e.some(function(e){var r=e.some(function(e){return e===t});return r&&(n=e),r}),n}}),define("utility/transition",["../config"],function(e){d3.selection.prototype.attrTween||(d3.selection.prototype.attrTween=function(t,n){return this.each(function(r,i,s){var o=n.call(this,r,i,s);o&&d3.select(this).attr(t,o(1))})}),d3.selection.prototype.styleTween||(d3.selection.prototype.styleTween=function(t,n){return this.each(function(r,i,s){var o=n.call(this,r,i,s);o&&d3.select(this).style(t,o(1))})});var t=function(t,n,r){typeof n=="number"&&(r=n,n=undefined);var i=t,s=e.transition.detail()===e.transition.none?i:i.transition().duration(r||e.transition.duration()).ease(e.transition.easing()),o=s;return n&&(o=s.selectAll(n),t=i.selectAll(n)),{highDetail:function(){return e.transition.allowsHighDetail()?o:t},lowDetail:function(){return e.transition.allowsLowDetail()?o:t},always:function(){return o},fadeToRemove:function(){var n=t.some(function(e){return e.some(function(t){return t&&t.nodeName==="text"})});this.lowDetail().style("fill-opacity",1e-6).style("stroke-opacity",1e-6),n&&this.lowDetail().attr("opacity",1e-6),s.remove()}}};return t.cancel=function(e){t(e)},t}),define("utility/uuid",[],function(){return function(e){var t="",n,r;for(n=0;n<32;n++){r=Math.random()*16|0;if(n===8||n===12||n===16||n===20)t+="-";t+=(n===12?4:n===16?r&3|8:r).toString(16)}return e?e+t:t}}),define("utility/scale",{updateDomain:function(e,t){var n=e.domain(),r=0,i=1;return n[1]<n[0]&&(r=1,i=0),e.domain([t[r],t[i]]),e},padDomain:function(e,t){var n=Math.abs(e[0]-e[1])*t;return e[1]<e[0]&&(n=-n),[e[0]?e[0]-n:0,e[1]?e[1]+n:0]}}),define("utility/fun",{IDENTITY:function(e){return e},TRUE:function(){return!0},FALSE:function(){return!1}}),define("utility",["./utility/aggregate","./utility/order","./utility/selection","./utility/transition","./utility/uuid","./utility/scale","./utility/fun"],function(e,t,n,r,i,s,o){return{aggregate:e,order:t,selection:n,transition:r,uuid:i,scale:s,fun:o}}),define("mark/constants",{BASE_FONT_SIZE:14,DEFAULT_DOT_SIZE:7,DEFAULT_POINT_MARK_RADIUS:4,DEFAULT_LINE_SIZE:2,DEFAULT_COLOR:"#3182bd",DEFAULT_TEXT_COLOR:"#000000",DEFAULT_CHANNEL_FILL_PERCENT:.6}),define("mark/styler",["./constants"],function(e){return function(t,n){n=n||{};var r=function(e){return e.datapoint||e},i={fillOpacity:function(e){return typeof t.opacity=="function"?t.opacity(r(e).opacity):t.opacity?t.opacity:n.opacity!==undefined?n.opacity:1},strokeOpacity:function(e){return typeof t.opacity=="function"&&t.opacity(r(e).opacity)<1?1e-6:t.opacity&&t.opacity<1?1e-6:n.borderOpacity!==undefined?n.borderOpacity:1},fill:function(i){return typeof t.color=="function"?t.color(r(i).color):t.color?t.color:n.color!==undefined?n.color:e.DEFAULT_COLOR},stroke:function(e){return typeof t.borderColor=="function"?t.borderColor(r(e).borderColor):t.borderColor?t.borderColor==="darker"?d3.rgb(i.fill(e)).darker().toString():t.borderColor==="lighter"||t.borderColor==="brighter"?d3.rgb(i.fill(e)).brighter().toString():t.borderColor:n.borderColor!==undefined?n.borderColor:"none"},strokeWidth:function(e){return typeof t.borderWidth=="function"?t.borderWidth(r(e).borderWidth):t.borderWidth?t.borderWidth<1?0:t.borderWidth:n.borderWidth!==undefined?n.borderWidth:0},z:function(e){return typeof t.z=="function"?t.z(r(e).z):t.z?t.z:0}};return i}}),define("mark/styles",[],function(){function e(e,t){var n={};return Object.keys(e).forEach(function(r){switch(r){case"color":e.color!==t.color&&(n.color=e.color);break;case"opacity":e.opacity!==t.opacity&&(n.opacity=e.opacity);break;case"borderColor":e.borderColor!==t.borderColor&&(n.borderColor=e.borderColor);break;case"borderOpacity":e.borderOpacity!==t.borderOpacity&&(n.borderOpacity=e.borderOpacity);break;case"borderWidth":e.borderWidth!==t.borderWidth&&(n.borderWidth=e.borderWidth);break;case"z":e.z!==t.z&&(n.z=e.z);break;case"visible":e.visible!==t.visible&&(n.visible=e.visible)}}),n}function t(e){return{color:e.color,opacity:e.opacity,borderColor:e.borderColor,borderOpacity:e.borderOpacity,borderWidth:e.borderWidth,z:e.z,visible:e.visible}}function n(n,r,i){var s={color:r.fill(n),opacity:r.fillOpacity(n),borderColor:r.stroke(n),borderOpacity:r.strokeOpacity(n),borderWidth:r.strokeWidth(n),z:r.z(n),visible:!0},o=t(s);return i&&(o=i(n.datapoint||n,o)),{nominal:s,overrides:e(o,s)}}return{calculateStyles:n,color:function(e){var t=e.styles||e;return t.overrides.color!==undefined?t.overrides.color:t.nominal.color},opacity:function(e){var t=e.styles||e;return t.overrides.opacity!==undefined?t.overrides.opacity:t.nominal.opacity},borderColor:function(e){var t=e.styles||e;return t.overrides.borderColor!==undefined?t.overrides.borderColor:t.nominal.borderColor},borderOpacity:function(e){var t=e.styles||e;return t.overrides.borderOpacity!==undefined?t.overrides.borderOpacity:t.nominal.borderOpacity},borderWidth:function(e){var t=e.styles||e;return t.overrides.borderWidth!==undefined?t.overrides.borderWidth:t.nominal.borderWidth},z:function(e){var t=e.styles||e;return t.overrides.z!==undefined?t.overrides.z:t.nominal.z},visible:function(e){var t=e.styles||e;return t.overrides.visible!==undefined?t.overrides.visible:t.nominal.visible}}}),define("mark/zOrder",["./styles","../utility"],function(e,t){function n(e){return e.__data__||e}function r(t){var r=n(t);return r.z!==undefined?r.z:e.z(r)}function i(e){return n(e).index}function s(e){return n(e).next}function o(e,t){var n=e;while(n){var i=r(n);if(i&&t||!i&&!t)return n;n=s(n)}}function u(e,t){var r=null;return e.some(function(e){return t(n(e))&&(r=e),r!==null}),r}function a(e){var t=[];return e.forEach(function(e){t[i(e)]=e}),t}function f(e){var t=!1;return e.forEach(function(n,i){n.index=i,n.next=e[i+1],t=t||r(n)}),t?e.filter(function(e){return!r(e)}).concat(e.filter(function(e){return r(e)})):e}function l(e){var t,n,i,s,o;for(t=0;t<e.length;t++){i=e[t];if(i.length){s=i[i.length-1],r(s)&&s.nextSibling&&s.parentNode.appendChild(s);for(n=i.length-2;n>=0;n--){o=i[n];var u=r(s),a=r(o);o&&s&&o.nextSibling!==s&&(u&&a||!u&&!a)&&s.parentNode.insertBefore(o,s),s=o}}}}function c(e,t){var n=0,s=t[n],o;for(o=0;o<e.length;++o){var u=e[o],a=i(u);while(!r(s)&&a>i(s)){s=t[++n];if(!s)return}u.parentNode.insertBefore(u,s)}}function h(e,t){var n=t.length-1,s=t[n],o;for(o=e.length-1;o>=0;--o){var u=e[o],a=i(u);while(r(s)&&a<i(s)){s=t[--n];if(!s)return}u.parentNode.insertBefore(u,s.nextSibling||null)}}function p(e,t){var n=[];t.forEach(function(t,r){n[r]=[];var s=a(e[r]);t.forEach(function(e){s[i(e)]||n[r].push(e)})});var s;for(s=0;s<e.length;++s){var o=e[s],u=n[s];if(o.length===0||u.length===0)continue;r(o[0])?o.length<u.length?h(o,u):c(u,o):o.length<u.length?c(o,u):h(u,o)}}function d(e,n){var a=t.selection.findContainingGroup(n,e),f,l;r(e)?(f=o(s(e),!0),f?(l=u(a,function(e){return i(e)===i(f)}),e.parentNode.insertBefore(e,l||null)):e.parentNode.appendChild(e)):r(e)||(f=o(s(e),!1),f?(l=u(a,function(e){return i(e)===i(f)}),e.parentNode.insertBefore(e,l||null)):(l=u(a,function(e){return r(e)}),e.parentNode.insertBefore(e,l||null)))}return{prepareData:f,orderDOMBySelection:l,orderDOMBulk:p,repositionNode:d}}),define("mark/centroidPlot",["../utility","../config","./styler","./styles","./zOrder"],function(e,t,n,r,i){return function(s,o,u,a){function l(e){var t=function(e){return"translate("+(e.xPos+e.xOff)+", "+(e.yPos+e.yOff)+")"},n=e.skipCentroidEntryTransform?t:function(e){return"translate("+(o.isCategorical(o.coordinates.scaleX())?e.xPos:o.coordinates.scaleX()(0))+", "+(o.isCategorical(o.coordinates.scaleY())?e.yPos:o.coordinates.scaleY()(0))+")"};return function(r,i,s){return d3.interpolate(s||n(r),t(r))}}function c(){return function(e){var t=this._current?d3.interpolateNumber(this._current.angle,e.angle):d3.interpolateNumber(0,e.angle);return this._current=e,function(n){var r=o.coordinates.position(e.radius,t(n));return"translate("+r.x+", "+r.y+")"}}}function h(e){if(o.coordinates.type==="rectangular")return l(e);if(o.coordinates.type==="polar")return c(e)}function p(e,t){e.styles=t}function d(e,t){return r.calculateStyles(e,f,t||o.propertyOverrides.point)}function v(e,t){var n=d(e,t);p(e,n)}function m(t,n){var r=n.layoutInfo(t).map(function(e){return e.values}),s=[].concat.apply([],r).filter(e.fun.TRUE);s.forEach(function(e){v(e)});var o=n.sort();return o&&s.sort(function(e,t){return o(e.datapoint,t.datapoint)}),i.prepareData(s)}function g(n,s){var u=n.selectAll(".datapoint").data(m(n,s),function(e){return e.datapoint.id}),a=h(s);!t.transition.allowsHighDetail()&&t.transition.allowsLowDetail()&&u.each(function(e){var t=this.getAttribute("transform"),n=a(e)(1);if(t===n)return;o.markType==="text"?d3.select(this).selectAll(".rendering,.label").attr("opacity",1e-6):d3.select(this).selectAll(".rendering,.label").style("fill-opacity",1e-6).style("stroke-opacity",1e-6)}),u.enter().append("g").attr("class","datapoint "+s.id).append("title"),u.select("title").text(o.tooltip),u.attr("display",function(e){return r.visible(e)?null:"none"}),i.orderDOMBySelection(u);var f=e.transition(u);return f.highDetail().attrTween("transform",a),e.transition(u.exit(),".rendering,.label").fadeToRemove(),u.activeTransition=f,u}function y(t,n){if(o.hasLabel){var r=t.selectAll("text.label").data(function(e){return[e]});r.enter().append("text").attr("class","label").attr("fill","black").attr("opacity",1e-6),r.text(function(e){return e.datapoint.label}),n.positionLabels(r),e.transition(r).lowDetail().attr("opacity",1),e.transition(r.exit()).fadeToRemove()}else e.transition(t.selectAll("text.label")).fadeToRemove()}function b(e,t){var n=t.renderer(e);e.attr("class","datapoint "+t.id),n(e),t.ignoresUserEvents||o.bindEvents("rendering "+t.id)}function w(){return s(o,u,a)}function E(e){var t=w(),n=g(e,t);b(n,t),t.positionLabels&&y(n,t)}function S(e,t,n,s){var o=!0,u=!0,a=[],f={};t.each(function(e,t,i){a[i]||(a[i]=[]);var s=d(e,n);f[e.datapoint.id]=s;var l=r.z(e),c=r.z(s);l!==c&&(o=!!(o&&!l&&c),u=!!(u&&l&&!c),a[i].push(this))});var l=50,c=!1;a.forEach(function(e){c=c||(o||u)&&e.length>l}),t.each(function(e){var t=r.z(e);p(e,f[e.datapoint.id]),t!==r.z(e)&&!c&&i.repositionNode(this,s)}).attr("display",function(e){return r.visible(e)?null:"none"}),c&&i.orderDOMBulk(a,s),e.update(t)}function x(e,t,n){var r=typeof n=="function",i=w(),s=e.selectAll(".datapoint"),o=n?s.filter(function(e){return e.datapoint?r?n(e.datapoint):n.indexOf(e.datapoint.id)!==-1:!1}):s;S(i,o,t.point,s)}var f=n(o,s.defaultStyles);return{render:E,update:x}}}),define("mark/renderState",[],function(){return function(){var e={},t={},n={};return n.domain=function(){return e},t.xDomain=function(n){return arguments.length?(e.x=n,t):e.x},t.yDomain=function(n){return arguments.length?(e.y=n,t):e.y},t.exportState=function(){return n},t}}),define("mark/linePlot",["./renderer","./renderState","../utility","../config","./styler"],function(e,t,n,r,i){return function(e,t){function s(e){var t=e.selectAll("defs");return t.empty()&&(t=e.insert("defs","*").attr("class","rendering-support")),t}function o(){return e(t)}function u(e,t){var r=t.selectAll(".datapoint.line").data(e,function(e){return e.key+(e.subgroupKey||"")});return r.enter().append("g").attr("class","datapoint line"),o().order(r),n.transition(r.exit(),".rendering,.label").fadeToRemove(),r}function a(e){var n=e.createLayout();return e.createLineGroups(n,r,t.propertyOverrides.series)}function f(e){var t=e.attr("plotId"),n=o(),r=a(n),i=s(e),f=u(r,e);n.render(f,i,t)}function l(e,t,n){o().update(e.selectAll(".datapoint.line"),e.selectAll("defs"),r,t.series,n)}var r=i(t,e.defaultStyles);return{render:f,update:l}}}),define("mark/hex",["./renderer","./renderState","../utility","../config"],function(e,t,n,r){return function(e){function i(n){var i=n.x,s=n.y;if(e.isQxQ()){var o=Math.floor(i/1.5/t),u=o*1.5*t,a;return o%2===0?a=Math.floor(s/2/r)*2*r:a=Math.floor((s-r)/2/r)*2*r+r,[{x:u,y:a},{x:u,y:a+2*r},{x:u+1.5*t,y:a+r}]}if(e.isQuantitative(e.coordinates.scaleX())){var f=Math.floor(i/2/r);return[{x:f*2*r,y:s},{x:(f+1)*2*r,y:s}]}if(e.isQuantitative(e.coordinates.scaleY())){var l=Math.floor(s/2/r);return[{x:i,y:l*2*r},{x:i,y:(l+1)*2*r}]}return[{x:i,y:s}]}function s(n){var r=e.coordinates.position([n.x,n.y]),s=i(r),o=2*t*t,u=s[0];return s.forEach(function(e){var t=Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2);t<o&&(u=e,o=t)}),u}function o(){var t=[],n=[],r=0;return e.datapoints.forEach(function(e){var i=s(e),o=i.x,u=i.y,a=n[o]?n[o][u]:undefined;a||(n[o]||(n[o]=[]),a=n[o][u]={x:o,y:u,datapoints:[]},t.push(a)),a.datapoints.push(e),r=Math.max(r,a.datapoints.length)}),{layoutPoints:t,maxDatapoints:r}}function u(t){var n="#3182bd",r=d3.rgb(n).hsl().brighter(2).rgb();if(e.color&&e.color.range){var i=e.color.range();i.length===1&&i[0]?(n=i[0],r=d3.rgb(n).hsl().brighter(2).rgb()):i.length>1&&(n=i[0],r=i[i.length-1])}return d3.scale.linear().domain([0,t]).range([r,n])}function a(n){return!e.isCategorical(e.coordinates.scaleX())&&e.isCategorical(e.coordinates.scaleY())?["M","0,",t,"L",r,",",t/2,"L",r,",",-t/2,"L","0,",-t,"L",-r,",",-t/2,"L",-r,",",t/2,"Z"].join(""):["M",t,",0","L",t/2,",",r,"L",-t/2,",",r,"L",-t,",0","L",-t/2,",",-r,"L",t/2,",",-r,"Z"].join("")}function f(e,t){function s(e){return r(e.datapoints.length)}function o(e){var t=s(e),n=d3.rgb(t).hsl();return n.l>.4?"#000000":"#DDDDDD"}var r=u(t.maxDatapoints),i=e.selectAll("g.hex").data(t.layoutPoints);i.enter().append("g").attr("class","hex rendering"),i.attr("transform",function(e){return"translate("+e.x+","+e.y+")"});var f=i.selectAll("path").data(function(e){return[e]});f.enter().append("path").attr("class","rendering"),f.attr("d",a).attr("stroke-width",0).attr("stroke",null).attr("display",function(e){return e.datapoints.length?null:"none"}).attr("fill",s);var l=f.selectAll("title").data(function(e){return[e]});l.enter().append("title"),l.text(function(e){return e.datapoints.length||null});if(n){var c=i.selectAll("text").data(function(e){return[e]});c.enter().append("text").attr("class","rendering").append("title"),c.text(function(e){return e.datapoints.length||null}).attr("text-anchor","middle").attr("dy",4).attr("fill",o);var h=c.selectAll("title").data(function(e){return[e]});h.enter().append("title"),h.text(function(e){return e.datapoints.length||null})}i.exit().remove()}function l(e){var t=o();f(e,t)}var t=15,n=!0,r=t*Math.cos(Math.PI/6);return{render:l}}}),define("mark/sizer",["./constants"],function(e){return function(t){var n=function(e){return e.datapoint||e};return{radius:function(r){return t.scale*(t.size?t.size(n(r).size):e.DEFAULT_DOT_SIZE)},pointMarkRadius:function(){return t.scale*e.DEFAULT_POINT_MARK_RADIUS},lineSize:function(r){return t.scale*(t.size?t.size(n(r).size):e.DEFAULT_LINE_SIZE)},fontSize:function(r){return t.scale*(t.size?t.size(n(r).size):e.BASE_FONT_SIZE)}}}}),define("layout/base",[],function(){return function(e){e=e||{};var t=function(e,t,n){return e.x},n=function(e,t,n){return e.y},r=function(e){return e.id};e.xPosition=t,e.yPosition=n,e.groupKey="",e.pointKey=r;var i={};return i.groupKey=function(t){return e.groupKey=t,i},i.pointKey=function(t){return e.pointKey=t||r,i},i.xPosition=function(n){return e.xPosition=n||t,i},i.yPosition=function(t){return e.yPosition=t||n,i},i}}),define("layout/basic",["./base"],function(e){return function(){var t={},n=e(t);return n.layout=function(e){var r=d3.nest().key(function(e){return t.groupKey||(t.groupKey=function(){return""}),t.groupKey.call(n,e)}).rollup(function(e){return e.map(function(e,r,i){return{datapoint:e,xPos:t.xPosition.call(n,e,r,i),yPos:t.yPosition.call(n,e,r,i),xOff:0,yOff:0,key:t.pointKey.call(n,e)}})}).entries(e);return r},n}}),define("layout/basicPolar",["./base"],function(e){return function(){var t={},n=e(t),r=function(e,t,n){return 0},i=function(e,t,n){return 0};return t.radius=r,t.angle=i,n.layout=function(e){var r=d3.nest().key(function(e){return t.groupKey||(t.groupKey=function(){return""}),t.groupKey.call(n,e)}).rollup(function(e){return e.map(function(e,r,i){return{datapoint:e,xPos:t.xPosition.call(n,e,r,i),yPos:t.yPosition.call(n,e,r,i),xOff:0,yOff:0,radius:t.radius.call(n,e,r,i),angle:t.angle.call(n,e,r,i)}})}).entries(e);return r},n.radius=function(e){return t.radius=e||r,n},n.angle=function(e){return t.angle=e||i,n},n}}),define("layout/jitter",["./base"],function(e){return function(){var t={},n="both",r="uniform",i=0,s=0,o=e(t),u;o.layout=function(e){var r=d3.nest().key(function(e){return t.groupKey||(t.groupKey=function(e){return n==="vertical"?e.x:n==="horizontal"?e.y:e.x+" "+e.y}),t.groupKey.call(o,e)}).rollup(function(e){return e.map(function(e,n,r){var i={datapoint:e,xPos:t.xPosition.call(o,e,n,r),yPos:t.yPosition.call(o,e,n,r),xOff:u("x"),yOff:u("y")};return i})}).entries(e);return r},o.direction=function(e){return arguments.length?(n=e,o):n},o.distribution=function(e){return arguments.length?(r=e,o):r},o.width=function(e){return arguments.length?(i=e,o):i},o.height=function(e){return arguments.length?(s=e,o):s};var a=function(e){return Math.random()*e-e/2},f=function(e){return(Math.random()+Math.random()+Math.random()+Math.random())/4*e-e/2};return u=function(e){return n==="both"||e==="x"&&n==="horizontal"||e==="y"&&n==="vertical"?r==="uniform"?a(e==="x"?i:s):r==="normal"?f(e==="x"?i:s):0:0},o}}),define("layout/pie",["./base"],function(e){return function(){var t={},n=e(t),r=function(e,t,n){return 1},i=r;return n.layout=function(e){var r=d3.nest().key(function(e){return t.groupKey||(t.groupKey=function(){return""}),t.groupKey.call(n,e)}).rollup(function(e){var r=e.map(function(e,t,n){var r=i(e,t,n);return typeof r=="number"?r:r===null||r===undefined?0:1});r.every(function(e){return e===0})&&(r=r.map(function(){return 1}));var s=d3.layout.pie().value(Math.abs).sort(null)(r);return e.map(function(e,r,i){var o={datapoint:e,xPos:t.xPosition.call(n,e,r,i),yPos:t.yPosition.call(n,e,r,i),xOff:0,yOff:0,startAngle:s[r].startAngle,endAngle:s[r].endAngle};return o})}).entries(e);return r},n.value=function(e){return i=e||r,n},n}}),define("layout/stack",["./base"],function(e){return function(){var t={},n=e(t),r="vertical",i=!0,s=!1,o=!1,u=0,a=0,f=null,l=null,c=function(){var e=[];return this.forEach(function(t,n,r){t.values.forEach(function(i,s){e[s]=e[s]||{key:i.key,subgroupKey:i.subgroupKey,values:[]},e[s].values.length=r.length,i.key=t.key,e[s].values[n]=i})}),e};return n.layout=function(e){t.groupKey||(t.groupKey=function(e){if(o)return"";if(i)return e.x;if(s)return e.y});var r={},h={},p={};e.forEach(function(e){var i=t.groupKey.call(n,e);r.hasOwnProperty(i)||(r[i]=Object.keys(r).length);var s=t.pointKey.call(n,e);h.hasOwnProperty(s)||(h[s]=Object.keys(h).length);var o=f?f.call(n,e):null;p.hasOwnProperty(o)||(p[o]=Object.keys(p).length)}),l&&Object.keys(r).sort(l).forEach(function(e,t){r[e]=t});var d=d3.nest().key(function(e){return t.groupKey.call(n,e)}).sortKeys(function(e,t){return r[e]-r[t]}).rollup(function(e){var r,o=[],l=[],c=[];for(r=0;r<Object.keys(p).length;r++)o[r]=[],l[r]=!1,c[r]=!1;e.forEach(function(e,t,n){var r=f?f(e):null;o[p[r]].push(e),s&&(typeof u=="function"?u(e,t,n):u)>0&&(l[p[r]]=!0),i&&(typeof a=="function"?a(e,t,n):a)>0&&(c[p[r]]=!0)});var d=Object.keys(p).map(function(e){var r=0,f=0,d=0,v=0,m=c[p[e]],g=l[p[e]],y=[];return y.length=Object.keys(h).length,o[p[e]].sort(function(e,r){return h[t.pointKey.call(n,e)]-h[t.pointKey.call(n,r)]}).forEach(function(o,l,c){var p=s?typeof u=="function"?u(o,l,c):u:0,b=i?typeof a=="function"?a(o,l,c):a:0,w={datapoint:o,xPos:t.xPosition.call(n,o,l,c),yPos:t.yPosition.call(n,o,l,c),height:i?b:undefined,width:s?p:undefined,xOff:s?p>0||p===0&&g?r:f:0,yOff:i?-(b>0||b===0&&m?d:v):0,key:t.pointKey.call(n,o,l,c),subgroupKey:e,isXNeg:s&&(p<0||p===0&&!g),isYNeg:i&&(b<0||b===0&&!m)};r+=p>0?p:0,f+=p<0?p:0,d+=b>0?b:0,v+=b<0?b:0,y[h[w.key]]=w}),y});if(d.length===1)return d[0];var v=[];return d.forEach(function(e){v=v.concat(e)}),v}).entries(e);return d.transpose=c,d},n.direction=function(e){return arguments.length?(r=e,o=e==="both",i=e==="vertical"||o,s=e==="horizontal"||o,n):r},n.subgroupKey=function(e){return arguments.length?(f=e,n):f},n.groupComparator=function(e){return arguments.length?(l=e,n):l},n.size=function(e){return arguments.length?(u=e,a=e,n):a},n.sizeX=function(e){return arguments.length?(u=e,n):u},n.sizeY=function(e){return arguments.length?(a=e,n):a},n}}),define("layout/treemap",["./base"],function(e){return function(){var t={},n=e(t),r=function(){var e={};return{itemExists:function(t){return e[t]!==undefined},getItem:function(t){var n=e[t];return n.wasUsed=!0,{d3_treemap:n.d3_treemap,hierarchy:n.hierarchy}},addItem:function(t){e[t]={d3_treemap:d3.layout.treemap().sticky(!0),hierarchy:{name:"root",children:[]},wasUsed:!1}},toString:function(){var t="",n;for(n in e)e.hasOwnProperty(n)&&(t.length>0&&(t+="; "),t+=n);return t},evictSquatters:function(){var t;for(t in e)e.hasOwnProperty(t)&&(e[t].wasUsed?e[t].wasUsed=!1:delete e[t])}}}(),i,s,o;return n.layout=function(e){var u=d3.nest().key(function(e){t.groupKey||(t.groupKey=function(){return""});var i=t.groupKey.call(n,e);return r.itemExists(i)||r.addItem(i),i}).rollup(function(e){var u=t.groupKey.call(n,e[0]),a=r.getItem(u).d3_treemap,f=r.getItem(u).hierarchy;s(f,e)&&(f.children=e.map(function(e,t){return{name:e.value}}),a.sticky(!0));var l=i;typeof l=="function"&&(l=l(e));var c=a.size(l).value(function(t){return o(e,t.name).size||1}).nodes(f);return c=c.slice(1),c.map(function(r,i,s){var u=o(e,r.name),a={datapoint:u,xPos:t.xPosition.call(n,u,i,e),yPos:t.yPosition.call(n,u,i,e),xOff:r.x,yOff:r.y,xExt:r.dx,yExt:r.dy};return a})}).entries(e);return r.evictSquatters(),u},n.dimensions=function(e){return arguments.length?(i=e,n):i},s=function(e,t){var n=!1;return t.length===e.children.length&&(n=e.children.every(function(e,n){return o(t,e.name)!==undefined})),!n},o=function(e,t){var n,r;for(r=0;r<e.length;r++)if(e[r].value===t){n=e[r];break}return n},n}}),define("layout/standard",["./basic","./stack","./jitter","../utility"],function(e,t,n,r){var i={sizeMultiplier:1,evenSpacingInStackedCxC:!1,domainBuffer:.05,defaultStackDirection:"vertical"};return function(s,o){o=o||{},Object.keys(i).forEach(function(e){o[e]===undefined&&(o[e]=i[e])});if(s.viewmode==="comparison"){var u;if(!s.jitter||s.jitter==="none")u=e();else{var a=s.isCategorical(s.coordinates.scaleX())?s.coordinates.scaleX().rangeBand()*.75:20,f=s.isCategorical(s.coordinates.scaleY())?s.coordinates.scaleY().rangeBand()*.75:20;u=n().width(a).height(f).distribution(s.jitter)}return u.groupKey(s.groupByCell).xPosition(function(e){return s.coordinates.position([e.x,e.y]).x}).yPosition(function(e){return s.coordinates.position([e.x,e.y]).y}).layout(s.datapoints)}var l=s.coordinates.scaleX(),c=s.coordinates.scaleY(),h=s.isQuantitative(c),p=s.isQuantitative(l),d=h&&p,v=!h&&!p,m=v&&s.isEmpty(l)&&!s.isEmpty(c),g=d?"both":p||m?"horizontal":h?"vertical":o.defaultStackDirection,y=p?0:l.rangeBand()*o.sizeMultiplier,b=h?0:c.rangeBand()*o.sizeMultiplier;if(p&&l.canAdjust){var w=r.aggregate.domainGroupSumSplitNegatives(s.datapoints,"x",d?"quadrants":"y");r.scale.updateDomain(l,r.scale.padDomain(w,o.domainBuffer))}if(h&&c.canAdjust){var E=r.aggregate.domainGroupSumSplitNegatives(s.datapoints,"y",d?"quadrants":"x");r.scale.updateDomain(c,r.scale.padDomain(E,o.domainBuffer))}var S=p?s.coordinates.position([0,undefined]).x:l.rangeBand()*.5,x=h?s.coordinates.position([undefined,0]).y:c.rangeBand()*.5;return t().direction(g).pointKey(function(e){return o.useSeriesKey?e.seriesKey:e.id}).groupKey(s.groupByCell).subgroupKey(d?function(e){return(e.x>=0?"+":"-")+(e.y>=0?"+":"-")}:undefined).sizeX(function(e,t,n){return v?y/(n.length+(o.evenSpacingInStackedCxC?1:0)):s.coordinates.position([e.x,e.y]).x-S}).sizeY(function(e,t,n){return v?b/(n.length+(o.evenSpacingInStackedCxC?1:0)):x-s.coordinates.position([e.x,e.y]).y}).xPosition(function(e,t,n){return v&&g==="horizontal"?s.coordinates.position([e.x,e.y]).x-S+y/(n.length+(o.evenSpacingInStackedCxC?1:0)):s.coordinates.position([e.x,e.y]).x}).yPosition(function(e,t,n){return v&&g==="vertical"?s.coordinates.position([e.x,e.y]).y+x-b/(n.length+(o.evenSpacingInStackedCxC?1:0)):s.coordinates.position([e.x,e.y]).y}).layout(s.datapoints)}}),define("layout",["./layout/basic","./layout/basicPolar","./layout/jitter","./layout/pie","./layout/stack","./layout/treemap","./layout/standard"],function(e,t,n,r,i,s,o){return{basic:e,basicPolar:t,jitter:n,pie:r,stack:i,treemap:s,standard:o}}),define("mark/dot",["./constants","./sizer","./styles","../layout","../utility","../config"],function(e,t,n,r,i,s){return function(e){function u(e){return e.attr("r",o.radius)}function a(e){return e.style("fill",n.color).style("fill-opacity",n.opacity).style("stroke",n.borderColor).style("stroke-opacity",n.borderOpacity).style("stroke-width",n.borderWidth)}function f(){var t;return e.coordinates.type==="rectangular"?!e.jitter||e.jitter==="none"?t=r.basic():t=r.jitter().width(e.isCategorical(e.coordinates.scaleX())?e.coordinates.scaleX().rangeBand()*.25:20).height(e.isCategorical(e.coordinates.scaleY())?e.coordinates.scaleY().rangeBand()*.25:20).distribution(e.jitter):t=r.basicPolar().radius(function(t){return e.coordinates.radius(t.x)}).angle(function(t){return e.coordinates.angle(t.y)}),t.xPosition(function(t){return e.coordinates.position([t.x,t.y]).x}),t.yPosition(function(t){return e.coordinates.position([t.x,t.y]).y}),t.groupKey(e.groupByCell).layout(e.datapoints)}function l(){return e.size?i.order.sizeComparator:undefined}function c(e){return e.selectAll("circle.rendering.dot").data(function(e){return[e]})}function h(e){var t=e.append("circle").attr("class","rendering dot");return t}function p(e){var t=c(e),n=i.transition(t);n.lowDetail().call(a)}function d(e){i.transition(e.selectAll(".rendering:not(circle)")).fadeToRemove();var t=c(e);h(t.enter()).style("fill",n.color).style("stroke",n.borderColor).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).style("stroke-width",n.borderWidth);var r=i.transition(t);r.highDetail().call(u),r.lowDetail().call(a)}function v(e){var t=c(e);h(t.enter()).style("display","none").call(a).call(u);var n=e.selectAll("rect.rendering");n.attr("rx",0).attr("ry",0).transition().duration(s.transition.duration()).attr("x",function(e){return-o.radius(e)}).attr("y",function(e){return-o.radius(e)}).attr("rx",o.radius).attr("ry",o.radius).attr("width",function(e){return 2*o.radius(e)}).attr("height",function(e){return 2*o.radius(e)}).each("end",function(){var e=d3.select(this.parentNode);d3.select(this).remove(),e.selectAll("circle").style("display",null)})}function m(e){e.selectAll(".morphing").remove();var t=c(e);h(t.enter()).style("display","none").call(a).call(u);var r=e.selectAll("text.rendering");r.style("font-size",function(e){return o.fontSize(e)+"px"}),r.each(function(){var e=d3.select(this.parentNode),t=d3.select(this);t.attr("class","morphing");var r=parseFloat(this.getComputedTextLength()),u=i.uuid("vxt-clip-path-"),f=e.append("clipPath").attr("class","morphing").attr("id",u),l="url(#"+u+")";e.attr("clip-path",l);var c=f.append("ellipse").attr("class","morphing").attr("rx",r*.75).attr("ry",o.fontSize),h=e.append("ellipse").attr("class","morphing").style("fill",n.color).style("stroke",n.borderColor).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).style("stroke-width",n.borderWidth).attr("rx",r*.75).attr("ry",o.fontSize);t.transition().duration(s.transition.duration()).style("font-size","200px").attr("dy",50).attr("opacity",1e-6),c.transition().duration(s.transition.duration()).attr("rx",function(e){return o.radius(e)+n.borderWidth(e)/2}).attr("ry",function(e){return o.radius(e)+n.borderWidth(e)/2}),h.transition().duration(s.transition.duration()).call(a).attr("rx",o.radius).attr("ry",o.radius).each("end",function(){t.remove(),f.remove(),e.attr("clip-path")===l&&e.attr("clip-path",null),h.remove(),e.selectAll("circle").style("display",null)})})}function g(e){var t=d;return!e.empty()&&s.transition.allowsHighDetail()&&((e.classed("bar")||e.classed("tile"))&&s.transition.allowsHighDetail()?t=v:e.classed("text")&&s.transition.allowsVeryHighDetail()&&(t=m)),t}function y(e){e.attr("x",function(){return 0}).attr("y",function(e){return-1*o.radius(e)-3}).attr("text-anchor",function(){return"middle"})}var o=t(e);return{layoutInfo:f,sort:l,renderer:g,positionLabels:y,update:p,id:"dot"}}}),define("mark/pie",["./constants","./styles","../config","../layout","../utility"],function(e,t,n,r,i){var s=.325,o=e.DEFAULT_DOT_SIZE;return function(e){function d(e){var t=(e.startAngle+e.endAngle)/2;return{startAngle:t,endAngle:t}}function m(t,n){if(!e.isQuantitative(e.coordinates.scaleX())&&e.coordinates.scaleX().domain().length!==1||!e.isQuantitative(e.coordinates.scaleY())&&e.coordinates.scaleY().domain().length!==1){var s=Math.min(f,l)/2,o=s/(n==="x"?f:l),u=i.aggregate.domainGroupSum(t,n,n==="x"?"y":"x",!0),a=(o*(u[0]+u[1])-u[0])/(2*o-1),c=u[1]+(u[0]-a);return a<0&&c>0?[a,c]:a<0?[u[0]/(1-o),0]:[0,u[1]/(1-o)]}var r=i.aggregate.sum(t,n);return r===0?[-10,10]:r>0?[0,2*r]:[2*r,0]}function g(){var t;return e.coordinates.scaleX().canAdjust&&e.isQuantitative(e.coordinates.scaleX())&&i.scale.updateDomain(e.coordinates.scaleX(),m(e.datapoints,"x")),e.coordinates.scaleY().canAdjust&&e.isQuantitative(e.coordinates.scaleY())&&i.scale.updateDomain(e.coordinates.scaleY(),m(e.datapoints,"y")),t=r.pie().value(function(t){return e.size?t.size:1}).xPosition(function(t,n,r){var s=t.x;return e.isQuantitative(e.coordinates.scaleX())&&(s=i.aggregate.sum(r,"x")),e.coordinates.position([s,t.y]).x}).yPosition(function(t,n,r){var s=t.y;return e.isQuantitative(e.coordinates.scaleY())&&(s=i.aggregate.sum(r,"y")),e.coordinates.position([t.x,s]).y}),t.groupKey(e.groupByCell).layout(e.datapoints)}function y(){return undefined}function b(e){return e.style("fill",t.color).style("fill-opacity",t.opacity).style("stroke","#ffffff").style("stroke-width","1").style("stroke-opacity",1)}function w(e){return e}function E(e){return e.selectAll("path").data(function(e){return[e]})}function S(e,r){var s=E(e),o=i.transition(s);o.lowDetail().call(b),o.highDetail().attrTween("d",v);var u=!s.empty(),a=r||!n.transition.allowsHighDetail(),f=s.enter().append("path").attr("class","rendering pie-segment").style("fill",t.color).style("stroke","#ffffff").style("stroke-width","1").style("fill-opacity",a?1e-6:t.opacity).style("stroke-opacity",a?1e-6:1),l=i.transition(f);return l.lowDetail().call(b),l.highDetail().attrTween("d",u?v:p),s}function x(e){return i.transition(e.selectAll(".rendering")).fadeToRemove(),S(e,!0)}function T(e){return!e.empty()&&!e.classed("pie-segment")?x:S}function N(e){var t=d3.svg.arc().innerRadius(c).outerRadius(c*1.2);e.attr("x",function(e){return t.centroid(e)[0]}).attr("y",function(e){return t.centroid(e)[1]}).attr("text-anchor",function(e){var t=2*Math.PI/5;return e.startAngle>=t*2&&e.endAngle<=t*3?"middle":e.endAngle<t*3?"start":"end"})}function C(e){var t=E(e),n=i.transition(t);n.lowDetail().call(b)}var u=e.canvasWidth(),a=e.canvasHeight(),f=e.isCategorical(e.coordinates.scaleX())?e.coordinates.scaleX().rangeBand():u,l=e.isCategorical(e.coordinates.scaleY())?e.coordinates.scaleY().rangeBand():a,c=e.scale*Math.max(Math.min(f,l)*s,o),h=d3.svg.arc().innerRadius(0).outerRadius(c),p=function(e){var t=this,n=d3.interpolateObject({startAngle:0,endAngle:0},{startAngle:e.startAngle,endAngle:e.endAngle});return function(e){return t._current=n(e),h(t._current)}},v=function(e){var t=this,n=d3.interpolateObject(this._current||d(e),{startAngle:e.startAngle,endAngle:e.endAngle});return function(e){return t._current=n(e),h(t._current)}};return{layoutInfo:g,sort:y,renderer:T,update:C,skipCentroidEntryTransform:!0,positionLabels:N,id:"pie-segment"}}}),define("mark/text",["./constants","./sizer","./styles","../layout","../utility","../config"],function(e,t,n,r,i,s){function u(e){return e*(11/14)/2-1}var o=e.BASE_FONT_SIZE,a=function(e){function l(){return undefined}function c(e){return e.selectAll("text.rendering").data(function(e){return[e]})}function h(e){var t=e.append("text").attr("class","rendering text").attr("text-anchor","middle");return t}function p(e){return e.style("fill",n.color).attr("opacity",n.opacity)}function d(e){return e.styleTween("font-size",f).attr("dy",function(e){return u(a.fontSize(e))})}function v(e){var t=c(e),n=i.transition(t);n.lowDetail().call(p)}function m(t){i.transition(t.selectAll(".rendering:not(text)")).fadeToRemove();var r=c(t);h(r.enter()).attr("dy",u(o)).attr("opacity",1e-6).style("font-size",parseFloat(e.scale*o)+"px").style("fill",n.color),r.text(function(e){return String(e.datapoint.value)});var s=i.transition(r);s.highDetail().call(d),s.lowDetail().call(p)}function g(e){e.selectAll(".morphing").remove();var t=c(e);h(t.enter()).style("font-size",function(e){return a.fontSize(e)+"px"}).attr("opacity",1e-6).style("fill",n.color),t.text(function(e){return String(e.datapoint.value)}),e.selectAll("circle.rendering").remove(),t.each(function(){var e=d3.select(this.parentNode),t=d3.select(this),r=i.uuid("vxt-clip-path-"),f=e.append("clipPath").attr("class","morphing").attr("id",r),l="url(#"+r+")";e.attr("clip-path",l);var c=f.append("ellipse").attr("class","morphing").attr("rx",function(e){return a.radius(e)+n.borderWidth(e)/2}).attr("ry",function(e){return a.radius(e)+n.borderWidth(e)/2}),h=e.append("ellipse").attr("class","morphing").style("fill",n.color).style("stroke",n.borderColor).style("fill-opacity",n.opacity).style("stroke-opacity",n.borderOpacity).style("stroke-width",n.borderWidth).attr("rx",a.radius).attr("ry",a.radius),p=parseFloat(this.getComputedTextLength());t.style("font-size","200px").attr("dy",50),t.transition().duration(s.transition.duration()).style("font-size",function(e){return a.fontSize(e)+"px"}).attr("opacity",n.opacity).attr("dy",u(o)),c.transition().duration(s.transition.duration()).attr("rx",p*.75).attr("ry",function(e){return a.fontSize(e)*.75}),h.transition().duration(s.transition.duration()).style("fill-opacity",0).style("stroke-opacity",0).style("stroke-width",n.borderWidth).attr("rx",p/2).attr("ry",function(e){return a.fontSize(e)/2}).each("end",function(){e.attr("clip-path")===l&&e.attr("clip-path",null),f.remove(),h.remove()})})}function y(e){var t=m;return!e.empty()&&s.transition.allowsVeryHighDetail()&&e.classed("dot")&&(t=g),t}var a=t(e),f=function(e){return e?d3.interpolate(this.style.getPropertyValue("font-size"),a.fontSize(e)+"px"):null};return{layoutInfo:r.standard.bind(null,e,{evenSpacingInStackedCxC:!0,domainBuffer:.1}),sort:l,renderer:y,update:v,id:"text"}};return a.defaultStyles={color:e.DEFAULT_TEXT_COLOR},a}),define("mark/bar",["./constants","./sizer","./styles","../layout","../utility","../config"],function(e,t,n,r,i,s){function f(o){function m(e){return e.style("fill",n.color).style("fill-opacity",n.opacity).style("stroke",n.borderColor).style("stroke-opacity",n.borderOpacity).style("stroke-width",n.borderWidth)}function g(e){return e.attr("x",v.x).attr("y",v.y).attr("width",v.width).attr("height",v.height).style("shape-rendering","crispEdges")}function y(){var e;if(o.viewmode==="comparison")e=r.basic().groupKey(o.groupByCell).xPosition(d.x).yPosition(d.y).layout(o.datapoints);else{var t=o.viewmode==="part-to-whole-stack"?l?"vertical":"horizontal":l?"horizontal":"vertical",n;if(o.viewmode==="part-to-whole-stack"&&!c){var s=o.coordinates[l?"scaleY":"scaleX"]();s.canAdjust&&(n=i.aggregate.domainGroupSumSplitNegatives(o.datapoints,l?"y":"x",o.isQxQ()?"none":undefined),i.scale.updateDomain(s,i.scale.padDomain(n,.05)))}if(o.isQxQ()){var u=o.coordinates.scaleX();if(u.canAdjust){var a=i.aggregate.sum(o.datapoints,"x"),f=a*.1;i.scale.updateDomain(u,[a-f,a+f])}}e=r.stack().direction(t).groupKey(o.groupByCell).xPosition(d.x).yPosition(d.y).size(function(e,n,r){return l?t==="vertical"?c?p/r.length:o.coordinates.position([undefined,0]).y-d.y(e,n,r):h/r.length:t==="horizontal"?c?h/r.length:d.x(e,n,r)-o.coordinates.position([0,undefined]).x:p/r.length}).layout(l||o.viewmode!=="part-to-whole-cluster"?o.datapoints:o.datapoints.slice(0).reverse())}return e}function b(){if(o.viewmode==="comparison")return i.order.positionAndSizeComparator}function w(e){return e.selectAll("rect.rendering").data(function(e){return[e]})}function E(e){var t=e.append("rect").attr("class","rendering bar").style("shape-rendering","crispEdges");return t}function S(e){var t=w(e),n=i.transition(t);n.lowDetail().call(m)}function x(e,t){var r=w(e),s=E(r.enter()).style("fill",n.color).style("stroke",n.borderColor).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).style("stroke-width",n.borderWidth);t?s.call(g):l?(s.attr("height",0),s.attr("width",v.width),s.attr("x",v.x),c?s.attr("y",function(e){return v.y(e)+v.height(e)-e.yOff}):s.attr("y",function(e){return v.y(e)<0?v.y(e)-e.yOff:v.height(e)-e.yOff})):(s.attr("width",0),s.attr("x",function(e){return v.x(e)<0?v.x(e)-e.xOff:v.width(e)-e.xOff}),s.attr("height",v.height),s.attr("y",v.y));var o=i.transition(e.activeTransition.highDetail().selectAll("rect.rendering"));o.lowDetail().call(m),o.highDetail().call(g)}function T(e){return i.transition(e.selectAll(".rendering:not(rect)")).fadeToRemove(),x(e,!0)}function N(e){return e.selectAll("rect").classed("tile",!1).classed("bar",!0),x(e,!1)}function C(e){e.selectAll("circle.rendering").remove();var t=w(e);E(t.enter()).attr("rx",f.radius).attr("ry",f.radius).attr("x",function(e){return-f.radius(e)}).attr("y",function(e){return-f.radius(e)}).attr("width",function(e){return 2*f.radius(e)}).attr("height",function(e){return 2*f.radius(e)}).call(m),t.transition().duration(s.transition.duration()).attr("rx","0").attr("ry","0").call(g)}function k(e){var t=x;return!e.empty()&&!e.classed("bar")&&(e.classed("dot")&&s.transition.allowsHighDetail()?t=C:e.classed("tile")?t=N:t=T),t}function L(e){e.attr("dy","-0.5em")}var f=t(o),l=o.isQuantitative(o.coordinates.scaleY())||!o.isQuantitative(o.coordinates.scaleX());o.isEmpty(o.coordinates.scaleX())&&o.isCategorical(o.coordinates.scaleY())&&!o.isEmpty(o.coordinates.scaleY())&&(l=!1);var c=!o.isQuantitative(o.coordinates.scaleY())&&!o.isQuantitative(o.coordinates.scaleX()),h=0,p=0;o.isQxQ()?(h=o.coordinates.scaleX().range()[1]*e.DEFAULT_CHANNEL_FILL_PERCENT,p=o.coordinates.scaleY().range()[0]*e.DEFAULT_CHANNEL_FILL_PERCENT):(o.isCategorical(o.coordinates.scaleX())&&(h=o.coordinates.scaleX().rangeBand()*e.DEFAULT_CHANNEL_FILL_PERCENT),o.isCategorical(o.coordinates.scaleY())&&(p=o.coordinates.scaleY().rangeBand()*e.DEFAULT_CHANNEL_FILL_PERCENT));var d=a(o,l,h,p),v=u(o,l,h,p);return{layoutInfo:y,sort:b,renderer:k,update:S,positionLabels:L,skipCentroidEntryTransform:!0,id:"bar"}}var o=15,u,a;return u=function(e,t,n,r){var i,s;if(!t)e.isQuantitative(e.coordinates.scaleX())?(i=function(t){return Math.abs(t.xPos-e.coordinates.position([0,undefined]).x)},s=function(t){return t.xPos>e.coordinates.position([0,undefined]).x?-i(t):0}):e.viewmode==="part-to-whole-stack"?(i=function(e){return e.width},s=function(e){return-i(e)}):(i=function(){return n},s=function(){return-e.coordinates.scaleX().rangeBand()*.5});else if(e.isQxQ())switch(e.viewmode){case"comparison":i=function(t){return e.size?e.size(t.datapoint.size):o},s=function(t){return-(e.size?e.size(t.datapoint.size):o)*.5};break;case"part-to-whole-stack":i=function(){return o},s=function(){return-o*.5};break;case"part-to-whole-cluster":i=function(){return n/e.datapoints.length},s=function(){return-i()}}else switch(e.viewmode){case"comparison":case"part-to-whole-stack":i=function(){return n},s=function(){return-n*.5};break;case"part-to-whole-cluster":i=function(t){var r=e.coordinates.position([t.datapoint.x,undefined]).x;return t.xPos-(r-n*.5)},s=function(e){return-i(e)}}var u,a;if(t)e.isQuantitative(e.coordinates.scaleY())?(u=function(t){return Math.abs(t.yPos-e.coordinates.position([undefined,0]).y)},a=function(t){return t.yPos>e.coordinates.position([undefined,0]).y?-u(t):0}):e.viewmode==="part-to-whole-stack"?(a=function(){return 0},u=function(e){return e.height}):(a=function(){return e.coordinates.scaleY().rangeBand()*.5-r},u=function(){return r});else if(e.isQxQ())switch(e.viewmode){case"comparison":u=function(t){return e.size?e.size(t.datapoint.size):o},a=function(t){return-(e.size?e.size(t.datapoint.size):o)*.5};break;case"part-to-whole-stack":u=function(){return r},a=function(){return-r*.5};break;default:u=function(){return r/e.datapoints.length},a=function(){return 0}}else e.viewmode==="part-to-whole-cluster"?(u=function(t){var n=e.coordinates.position([undefined,t.datapoint.y]).y;return n+r*.5-t.yPos},a=function(){return 0}):(u=function(){return r},a=function(){return-r*.5});return{x:s,y:a,width:i,height:u}},a=function(e,t,n,r){var s=function(e,t,n){return e.x},o=function(e,t,n){return e.y};e.viewmode!=="comparison"&&e.isQxQ()&&(s=function(e,t,n){return i.aggregate.sum(n,"x")});var u=function(t,n,r){return e.coordinates.position([s(t,n,r),undefined]).x},a=function(t,n,r){return e.coordinates.position([undefined,o(t,n,r)]).y};return e.viewmode==="part-to-whole-stack"&&!t&&!e.isQuantitative(e.coordinates.scaleX())?u=function(t,r,i){return e.coordinates.position([s(t,r,i),undefined]).x-e.coordinates.scaleX().rangeBand()*.5+n/i.length}:e.viewmode==="part-to-whole-cluster"&&t&&(u=function(t,r,i){return e.coordinates.position([s(t,r,i),undefined]).x-n*.5+n/i.length}),e.viewmode==="part-to-whole-stack"&&t&&!e.isQuantitative(e.coordinates.scaleY())?a=function(t,n,i){return e.coordinates.position([undefined,o(t,n,i)]).y+e.coordinates.scaleY().rangeBand()*.5-r/i.length}:e.viewmode==="part-to-whole-cluster"&&!t&&(a=function(t,n,i){return e.coordinates.position([undefined,o(t,n,i)]).y+r*.5-r/i.length}),{x:u,y:a}},f}),define("mark/tile",["./constants","./sizer","./styles","../layout","../utility","../config"],function(e,t,n,r,i,s){function f(e){function h(e){return e.style("fill",n.color).style("stroke",n.borderColor).style("fill-opacity",n.opacity).style("stroke-opacity",n.borderOpacity).style("stroke-width",n.borderWidth)}function p(e){return e.attr("x",l.x).attr("y",l.y).attr("width",l.width).attr("height",l.height)}function d(t){var n=e.coordinates.scaleX(),s=e.coordinates.scaleY(),u=e.isQuantitative(s),a=e.isQuantitative(n);t.selectAll(".layout-cache").empty()&&t.selectAll("g.layout-cache").data(function(){return[r.treemap()]}).enter().append("g").attr("class","rendering-support layout-cache");if(a&&n.canAdjust){var l=i.aggregate.domainGroupSumSplitNegatives(e.datapoints,"x",e.isQxQ()?"none":undefined);i.scale.updateDomain(n,[0,l[1]*1.05])}if(u&&s.canAdjust){var c=i.aggregate.domainGroupSumSplitNegatives(e.datapoints,"y",e.isQxQ()?"none":undefined);i.scale.updateDomain(s,[0,c[1]*1.05])}return t.selectAll(".layout-cache").datum().groupKey(e.groupByCell).dimensions(function(t){var n=[];return n[0]=e.isQuantitative(e.coordinates.scaleX())?e.coordinates.position([i.aggregate.sum(t,"x"),undefined]).x:e.coordinates.scaleX().rangeBand()-o,n[1]=e.isQuantitative(e.coordinates.scaleY())?e.coordinates.scaleY().range()[0]-e.coordinates.position([undefined,i.aggregate.sum(t,"y")]).y:e.coordinates.scaleY().rangeBand()-o,n}).xPosition(f.x).yPosition(f.y).layout(e.datapoints)}function v(){if(e.viewmode==="comparison")return i.order.positionAndSizeComparator}function m(e){return e.selectAll("rect").data(function(e){return[e]})}function g(e){var t=e.append("rect").attr("class","rendering tile").style("shape-rendering","crispEdges");return t}function y(e){var t=m(e),n=i.transition(t);n.lowDetail().call(h)}function b(t,r){var s=m(t),o=g(s.enter()).style("fill",n.color).style("stroke",n.borderColor).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).style("stroke-width",n.borderWidth);r?(o.attr("width",l.width),o.attr("height",l.height),o.attr("x",l.x),o.attr("y",l.y)):e.isQuantitative(e.coordinates.scaleY())?(o.attr("height",0),o.attr("y",0),e.isQuantitative(e.coordinates.scaleX())?(o.attr("width",0),o.attr("x",0)):(o.attr("width",l.width),o.attr("x",l.x))):e.isQuantitative(e.coordinates.scaleX())?(o.attr("width",0),o.attr("x",0),o.attr("height",l.height),o.attr("y",l.y)):e.viewmode==="part-to-whole-stack"&&(e.isEmpty(e.coordinates.scaleX())&&!e.isEmpty(e.coordinates.scaleY())?(o.attr("height",0),o.attr("y",0),o.attr("width",0),o.attr("x",function(e){return-l.width(e)/2})):(o.attr("height",0),o.attr("y",function(e){return l.height(e)/2}),o.attr("width",0),o.attr("x",0)));var u=i.transition(t.activeTransition.highDetail().selectAll("rect.rendering"));return u.lowDetail().call(h),u.highDetail().call(p),s}function w(e){return i.transition(e.selectAll(".rendering:not(rect)")).fadeToRemove(),b(e,!0)}function E(e){return e.selectAll("rect").classed("bar",!1).classed("tile",!0),b(e,!1)}function S(e){e.selectAll("circle.rendering").remove();var t=m(e);return g(t.enter()).attr("rx",c.radius).attr("ry",c.radius).attr("x",function(e){return-c.radius(e)}).attr("y",function(e){return-c.radius(e)}).attr("width",function(e){return 2*c.radius(e)}).attr("height",function(e){return 2*c.radius(e)}).call(h),t.transition().duration(s.transition.duration()).attr("rx","0").attr("ry","0").call(p),t}function x(e){var t=b;return!e.empty()&&!e.classed("tile")&&(e.classed("dot")&&s.transition.allowsHighDetail()?t=S:e.classed("bar")?t=E:t=w),t}function T(e){e.attr("dx","1em").attr("dy","1.5em").attr("text-anchor","left").attr("x",l.x).attr("y",l.y)}var f=a(e),l=u(e),c=t(e);return{layoutInfo:e.viewmode==="part-to-whole-cluster"?d:r.standard.bind(null,e,{domainBuffer:0}),sort:v,renderer:x,update:y,positionLabels:T,skipCentroidEntryTransform:e.isCategorical(e.coordinates.scaleX())&&e.isCategorical(e.coordinates.scaleY()),id:"tile"}}var o=4,u,a;return u=function(e){var t,n;if(e.viewmode==="part-to-whole-cluster")t=function(e){return e.xExt},n=e.isQuantitative(e.coordinates.scaleX())?function(){return 0}:function(){return-0.5*e.coordinates.scaleX().rangeBand()+o*.5};else if(e.isQuantitative(e.coordinates.scaleX()))t=function(t){return Math.abs(t.xPos-e.coordinates.position([0,undefined]).x)},n=function(n){return n.xPos>e.coordinates.position([0,undefined]).x?-t(n):0};else{var r=e.viewmode==="part-to-whole-stack"&&!e.isQuantitative(e.coordinates.scaleY())&&e.isEmpty(e.coordinates.scaleX())&&!e.isEmpty(e.coordinates.scaleY());r?(t=function(e){return e.width},n=function(e){return-e.width}):(t=function(){return e.coordinates.scaleX().rangeBand()-1},n=function(){return-0.5*e.coordinates.scaleX().rangeBand()})}var i,s;if(e.viewmode==="part-to-whole-cluster")i=function(e){return e.yExt},s=e.isQuantitative(e.coordinates.scaleY())?function(){return 0}:function(){return-0.5*e.coordinates.scaleY().rangeBand()+o*.5};else if(e.isQuantitative(e.coordinates.scaleY()))i=function(t){return Math.abs(e.coordinates.position([undefined,0]).y-t.yPos)},s=function(t){return t.yPos>e.coordinates.position([undefined,0]).y?-i(t):0};else{var u=e.viewmode==="part-to-whole-stack"&&!e.isQuantitative(e.coordinates.scaleX())&&(!e.isEmpty(e.coordinates.scaleX())||e.isEmpty(e.coordinates.scaleY()));u?(i=function(e){return e.height},s=function(){return 0}):(i=function(){return e.coordinates.scaleY().rangeBand()-1},s=function(){return-0.5*e.coordinates.scaleY().rangeBand()})}return{x:n,y:s,width:t,height:i}},a=function(e){var t=function(e,t,n){return e.x},n=function(e,t,n){return e.y};e.viewmode==="part-to-whole-cluster"&&e.isQuantitative(e.coordinates.scaleY())&&(n=function(e,t,n){return n.reduce(function(e,t){return e+t.y()},0)});var r=function(n,r,i){return e.coordinates.position([t(n,r,i),undefined]).x},i=function(t,r,i){return e.coordinates.position([undefined,n(t,r,i)]).y};return e.viewmode==="part-to-whole-cluster"&&(r=function(n,r,i){return e.isQuantitative(e.coordinates.scaleX())?0:e.coordinates.position([t(n,r,i),undefined]).x}),{x:r,y:i}},f}),define("mark/lineStub",["./constants","./sizer","./styles","../layout","../utility"],function(e,t,n,r,i){return function(s,o){function y(){if(s.viewmode==="comparison")return i.order.sizeComparator}function b(e){if(f){var t=s.coordinates.scaleX()(0),n=s.coordinates.scaleY()(0);return[{x:t-e.xPos,y:n-e.yPos},{x:0,y:0}]}var r=s.isCategorical(s.coordinates.scaleX());return s.isEmpty(s.coordinates.scaleX())&&s.isCategorical(s.coordinates.scaleY())&&!s.isEmpty(s.coordinates.scaleY())&&(r=!1),r?[{x:-v/2,y:0},{x:v/2,y:0}]:[{x:0,y:-m/2},{x:0,y:m/2}]}function w(e){var t=s.isQuantitative(s.coordinates.scaleX())?s.coordinates.scaleX()(0):null,n=s.isQuantitative(s.coordinates.scaleY())?s.coordinates.scaleY()(0):null;return f?[{x0:t-e.xPos-e.xOff,y0:0,x1:t-e.xPos-e.xOff,y1:n-e.yPos},{x0:0,y0:0,x1:t-e.xPos,y1:n-e.yPos},{x0:0,y0:n-e.yPos-e.yOff,x1:t-e.xPos,y1:n-e.yPos-e.yOff}]:c?p==="horizontal"?[{x0:0,x1:-e.xPos,y0:-m/2,y1:-m/2},{x0:0,x1:-e.xPos,y0:m/2,y1:m/2}]:(n=s.coordinates.position([undefined,e.datapoint.y]).y+s.coordinates.scaleY().rangeBand()*.5,[{x0:-v/2,x1:-v/2,y0:0,y1:n-e.yPos},{x0:v/2,x1:v/2,y0:0,y1:n-e.yPos}]):s.isCategorical(s.coordinates.scaleX())?[{x0:-v/2,x1:-v/2,y0:0,y1:n-e.yPos},{x0:v/2,x1:v/2,y0:0,y1:n-e.yPos}]:[{x0:0,x1:t-e.xPos,y0:-m/2,y1:-m/2},{x0:0,x1:t-e.xPos,y0:m/2,y1:m/2}]}function E(e){return e.selectAll("path").data(function(e){return[e]})}function S(e){return l&&e.style("stroke-width",n.borderWidth),e.style("fill",n.color).style("stroke",n.color).style("stroke-opacity",n.opacity).style("fill-opacity",n.opacity)}function x(t){return l||t.style("stroke-width",f?e.DEFAULT_LINE_SIZE:d.lineSize),t}function T(e){var t=E(e),n=i.transition(t);n.lowDetail().call(S)}function N(t){i.transition(t.selectAll(".rendering:not(path)")).fadeToRemove();var r=E(t),s=r.enter().append("path").attr("class","rendering").style("fill",n.color).style("stroke",n.color).style("stroke-width",e.DEFAULT_LINE_SIZE+"px").style("stroke-opacity",1e-6).style("fill-opacity",1e-6);if(l||f){var o={x:0,y:0},u=[o,o];l&&f&&u.push(o),s.attr("d",g(u))}var a=i.transition(r);return a.lowDetail().call(S),a.highDetail().call(x),a.highDetail().attr("d",function(e){return l?g(w(e)):g(b(e))}),r}function C(e){return N}function k(e){e.attr("x",0).attr("y",function(e){return-d.lineSize(e)-3})}var u=s.isQuantitative(s.coordinates.scaleY()),a=s.isQuantitative(s.coordinates.scaleX()),f=u&&a,l=s.viewmode==="part-to-whole-stack",c=s.isCategorical(s.coordinates.scaleX())&&s.isCategorical(s.coordinates.scaleY()),h=c&&s.isEmpty(s.coordinates.scaleX())&&!s.isEmpty(s.coordinates.scaleY()),p,d=t(s);o=o||"vertical",f?p="both":u?p="vertical":a?p="horizontal":h?p="horizontal":p=o;var v=s.isCategorical(s.coordinates.scaleX())?s.coordinates.scaleX().rangeBand()*e.DEFAULT_CHANNEL_FILL_PERCENT:0,m=s.isCategorical(s.coordinates.scaleY())?s.coordinates.scaleY().rangeBand()*e.DEFAULT_CHANNEL_FILL_PERCENT:0,g=d3.svg.area().x0(function(e){return e.x!==undefined?e.x:e.x0}).x1(function(e){return e.x!==undefined?e.x:e.x1}).y0(function(e){return e.y!==undefined?e.y:e.y0}).y1(function(e){return e.y!==undefined?e.y:e.y1});return{layoutInfo:r.standard.bind(null,s,{sizeMultiplier:e.DEFAULT_CHANNEL_FILL_PERCENT,defaultStackDirection:o}),sort:y,renderer:C,update:T,positionLabels:k,id:"line-point",ignoresUserEvents:!0}}}),define("mark/line",["./constants","./styles","./zOrder","../layout","../utility"],function(e,t,n,r,i){return function(s){function h(e,t){var n=e.pointA?s.color?e.pointA.color:e.pointA.id:null,r=e.pointB?s.color?e.pointB.color:e.pointB.id:null,i=e.pointA?s.opacity?e.pointA.opacity:e.pointA.id:null,o=e.pointB?s.opacity?e.pointB.opacity:e.pointB.id:null,u="Gradient";return u+="-"+(n||"")+"-"+(r||""),u+="-"+(i||"")+"-"+(o||""),u+="-"+t,u.replace(/(\s|[\"\'])+/g,"")}function d(e){return e.attr("d",function(e){return p(e.line)})}function v(t){return t.style("stroke-width",e.DEFAULT_LINE_SIZE+"px").style("stroke-opacity",1).style("fill-opacity",1)}function m(e,n){i.transition(e).lowDetail().style("stop-color",function(e){return t.color(e.stylesA)}).style("stop-opacity",function(e){return t.opacity(e.stylesA)}),i.transition(n).lowDetail().style("stop-color",function(e){return t.color(e.stylesB)}).style("stop-opacity",function(e){return t.opacity(e.stylesB)})}function g(){var e=r.basic().groupKey(function(e){return e.seriesKey+(c?";"+e[a]:"")}).pointKey(function(e){return e[f]}).xPosition(function(e){return s.coordinates.position([e.x,e.y]).x}).yPosition(function(e){return s.coordinates.position([e.x,e.y]).y}).layout(s.datapoints);return e}function y(e,t){var n=s.size?s.scale*s.size(e.datapoint.size):1,r=s.size?s.scale*s.size(t.datapoint.size):1;return[{x0:e.xPos-(o?0:n/2),x1:e.xPos+(o?0:n/2),y0:e.yPos-(o?n/2:0),y1:e.yPos+(o?n/2:0)},{x0:t.xPos-(o?0:r/2),x1:t.xPos+(o?0:r/2),y0:t.yPos-(o?r/2:0),y1:t.yPos+(o?r/2:0)}]}function b(e,r,i){var s=e.map(function(e){var n=!1,s=[];return e.values.reduce(function(e,a,f){var l=e.datapoint,c=a.datapoint,h=o;u&&(h=Math.abs(e.yPos-a.yPos)<Math.abs(e.xPos-a.xPos));var p=!1,d;h&&e.xPos>a.xPos?(d=l,l=c,c=d,p=!0):!h&&e.yPos>a.yPos&&(d=l,l=c,c=d,p=!0);var v;f===1?v=t.calculateStyles(l,r,i):v=p?t.calculateStyles(l,r,i):s[s.length-1].stylesB;var m=p&&f!==1?s[s.length-1].stylesA:t.calculateStyles(c,r,i);return n=n||t.z(v)||t.z(m),s.push({pointA:l,pointB:c,stylesA:v,stylesB:m,line:y(e,a),key:e.key+"-"+a.key,isXNeg:e.isXNeg,isYNeg:e.isYNeg,isHorizontal:h}),a}),{key:e.key,subgroupKey:e.subgroupKey,values:s,z:n}});return n.prepareData(s)}function w(e){n.orderDOMBySelection(e)}function E(e){var t=e.selectAll("stop.gradient-begin").data(function(e){return[e]}),n=e.selectAll("stop.gradient-end").data(function(e){return[e]});m(t,n)}function S(t,n,r){var s=[],o=[];t.each(function(e){e.values.forEach(function(e){var t=h(e,r);o.indexOf(t)<0&&(s.push(e),o.push(t))})});var u=n.selectAll(".lineargradient").data(s,function(e){return h(e,r)}),a=u.enter().append("linearGradient").attr("class","lineargradient");u.attr("id",function(e){return h(e,r)}).attr("y2",function(e){return e.isHorizontal?0:1}).attr("x2",function(e){return e.isHorizontal?1:0}),i.transition.cancel(u),a.append("stop").attr("class","gradient-begin").attr("offset","40%").style("stop-color",e.DEFAULT_COLOR).style("stop-opacity",1e-6),a.append("stop").attr("class","gradient-end").attr("offset","60%").style("stop-color",e.DEFAULT_COLOR).style("stop-opacity",1e-6),i.transition(u.exit()).always().remove(),E(u)}function x(e){return e.selectAll("path").data(function(e){return e.values.forEach(function(t){t.d3key="Positive;"+e.key+";"+t.key+(e.subgroupKey?";"+e.subgroupKey:"")}),e.values},function(e){return e.d3key})}function T(n,r){var s=x(n);s.enter().append("path").attr("class","rendering").style("fill",e.DEFAULT_COLOR).style("stroke",e.DEFAULT_COLOR).style("stroke-width",e.DEFAULT_LINE_SIZE+"px").style("stroke-opacity",1e-6).style("fill-opacity",1e-6);var o=function(e){return"url(#"+h(e,r)+")"};s.style("stroke",o).style("fill",o).style("stroke-linejoin","round").attr("display",function(e){return t.visible(e.stylesA)&&t.visible(e.stylesB)?null:"none"}),i.transition(s.exit()).fadeToRemove();var u=i.transition(s);u.highDetail().call(d),u.lowDetail().call(v)}function N(e){e.attr("display",function(e){return t.visible(e.stylesA)&&t.visible(e.stylesB)?null:"none"}),i.transition(e).lowDetail().call(v)}function C(e,t){var n=function(e){return t?t.some(function(t){return e.pointA.id===t||e.pointB.id===t}):!0};return t?e.filter(function(e){return e.values?e.values.some(n):n(e)}):e}function k(e,r,i,s){var o=[];e.selectAll("path.rendering").each(function(e){var n=null,u=null;o.some(function(t){return t.id===e.pointA.id?n=t.style:t.id===e.pointB.id&&(u=t.style),n!==null&&u!==null});if(n)e.stylesA=n;else if(!s||s.indexOf(e.pointA.id)!==-1)e.stylesA=t.calculateStyles(e.pointA,r,i),o.push({id:e.pointA.id,style:e.stylesA});if(u)e.stylesB=u;else if(!s||s.indexOf(e.pointB.id)!==-1)e.stylesB=t.calculateStyles(e.pointB,r,i),o.push({id:e.pointB.id,style:e.stylesB})});var u=[];e.each(function(r){var i=r.values.some(function(e){return t.z(e.stylesA)||t.z(e.stylesB)});if(!r.z&&i||r.z&&!i)r.z=i,n.repositionNode(this,e)})}function L(e,t){var n=[],r=[];return typeof e=="function"&&t.each(function(t){t.values.forEach(function(t){r.indexOf(t.pointA.id)===-1&&(r.push(t.pointA.id),e(t.pointA)&&n.push(t.pointA.id)),r.indexOf(t.pointB.id)===-1&&(r.push(t.pointB.id),e(t.pointB)&&n.push(t.pointB.id))})}),typeof e=="function"?n:e}function A(e,t,n){S(e,t,n),T(e,n)}function O(e,t,n,r,i){var s=L(i,e),o=C(e,s);k(o,n,r,s);var u=o.selectAll("path.rendering"),a=C(t.selectAll(".lineargradient"),s);N(u),E(a)}var o=s.isOrdinal(s.coordinates.scaleX())&&s.coordinates.scaleX().domain().length>1,u=s.isQxQ(),a=o?"y":"x",f=o?"x":"y",l=s.coordinates[o?"scaleY":"scaleX"](),c=s.isCategorical(l),p=d3.svg.area().x0(function(e){return e.x!==undefined?e.x:e.x0}).x1(function(e){return e.x!==undefined?e.x:e.x1}).y0(function(e){return e.y!==undefined?e.y:e.y0}).y1(function(e){return e.y!==undefined?e.y:e.y1}).interpolate(s.rounded?"cardinal":"linear");return{createLayout:g,createLineGroups:b,order:w,render:A,update:O}}}),define("mark/area",["./constants","./styles","../layout","../utility"],function(e,t,n,r){return function(i){function b(e){if(!e)return[];var t=e.match(/[MCQLS]|[0-9\.\-e]+/g),n=[];while(t.length)switch(t.shift()){case"M":n.push({point:[t.shift(),t.shift()]}),n[n.length-1].controlA=n[n.length-1].point,n[n.length-1].controlB=n[n.length-1].point;break;case"C":n.push({controlA:[t.shift(),t.shift()],controlB:[t.shift(),t.shift()],point:[t.shift(),t.shift()]});break;case"Q":n.push({controlA:[t.shift(),t.shift()],point:[t.shift(),t.shift()]}),n[n.length-1].controlB=n[n.length-1].controlA;break;case"L":n.push({point:[t.shift(),t.shift()]}),n[n.length-1].controlA=n[n.length-1].point,n[n.length-1].controlB=n[n.length-2].point;break;case"S":n.push({controlB:[t.shift(),t.shift()],point:[t.shift(),t.shift()]}),n[n.length-1].controlA=[2*n[n.length-2].point[0]-n[n.length-2].controlB[0],2*n[n.length-2].point[1]-n[n.length-2].controlB[1]]}return n}function w(e){return e.reduce(function(e,t,n){return e+(n?"C"+t.controlA.join(",")+" "+t.controlB.join(",")+" "+t.point.join(","):t.point.join(","))},"M")+"Z"}function E(e,t){var n=[],r=-1;t.forEach(function(t,i){var s=e.indexOf(t,r+1);if(s>=0){while(++r<s)n.push([r,undefined]);n.push([r,i])}else n.push([undefined,i])});while(++r<e.length)n.push([r,undefined]);return n}function S(e){var t=e.length/2,n=1;return e.forEach(function(r,i){if(r)return;n=Math.max(n,i+1);while(!e[n]&&n<e.length)n++;var s=e[n],o=e[i-1];i<t?e[i]=o?{controlA:o.point,controlB:o.point,point:o.point}:{controlA:s.point,controlB:s.point,point:s.point}:(e[i]=s?{controlA:s.controlA,controlB:o.point,point:s.point}:{controlA:o.point,controlB:o.point,point:o.point},s&&(s.controlB=s.point))}),e}function x(e){var t=this,n=t.__areaKeys__,r=e.values.map(function(e){return e.key});if(!n){t.__areaKeys__=r,t.setAttribute("d",y(e.line));return}var i=b(t.getAttribute("d")),s=b(y(e.line)),o=E(n,r),u=o.map(function(e){return e[0]!==undefined?n[e[0]]:r[e[1]]});o=o.concat(o.map(function(e){return[e[0]===undefined?undefined:i.length-e[0]-1,e[1]===undefined?undefined:s.length-e[1]-1]}).reverse());var a=S(o.map(function(e){return e[0]===undefined?undefined:i[e[0]]})),f=S(o.map(function(e){return e[1]===undefined?undefined:s[e[1]]})),l=d3.interpolate(w(a),w(f));return t.setAttribute("d",l(0)),t.__areaKeys__=u,function(n){return n===1?(t.__areaKeys__=r,y(e.line)):l(n)}}function T(e){return e.attrTween("d",x)}function N(e){return e.style("stroke-width","0px").style("stroke-opacity",1).style("fill-opacity",1)}function C(e){r.transition(e).lowDetail().attr("offset",function(e){return Math.max(0,Math.min(1,e.offset))}).style("stop-color",function(e){return t.color(e.layoutpoint)}).style("stop-opacity",function(e){return t.opacity(e.layoutpoint)})}function k(){if(!h&&a.canAdjust){var e=r.aggregate.domainGroupSumSplitNegatives(i.datapoints,o,u);r.scale.updateDomain(a,r.scale.padDomain(e,.05))}var t=n.stack().direction(s?"vertical":"horizontal").groupKey(function(e){return e[u]}).groupComparator(function(e,t){return c(e)-c(t)}).subgroupKey(h?function(e){return e[o]}:undefined).size(function(e,t,n){return h?d/n.length:s?l(0)-i.coordinates.position([e.x,e.y]).y:i.coordinates.position([e.x,e.y]).x-l(0)}).xPosition(function(e,t,n){return i.coordinates.position([e.x,e.y]).x+(s||!h?0:p+d/n.length)}).yPosition(function(e,t,n){return i.coordinates.position([e.x,e.y]).y+(s&&h?p-d/n.length:0)}).pointKey(function(e){return e.seriesKey}).layout(i.datapoints).transpose();return t}function L(e,t){return{x0:s?e.xPos:e.xPos+e.xOff,x1:s?e.xPos:t+e.xOff,y0:s?e.yPos+e.yOff:e.yPos,y1:s?t+e.yOff:e.yPos}}function A(e){var t=function(e){return function(t,n){return t||n.values[e]}};return e=e.filter(r.fun.TRUE),e.forEach(function(n,r){var i,a,f=h?l(n.values[Object.keys(n.values)[0]].datapoint[o])+p:l(0);for(i=0;i<n.values.length;i++)if(!n.values.hasOwnProperty(i))if(r&&e[r-1].isNegative===e[r].isNegative&&e[r-1].subgroupKey===e[r].subgroupKey)a=e[r-1].values[i],n.values[i]={},n.values[i][u+"Pos"]=a[u+"Pos"],n.values[i][u+"Off"]=a[u+"Off"],n.values[i][o+"Pos"]=f,n.values[i][o+"Off"]=a[o+"Off"]+(a[o+"Pos"]-f),n.values[i].key=a.key,n.values[i].isXNeg=a.isXNeg,n.values[i].isYNeg=a.isYNeg;else{var c=e.reduce(t(i),null);n.values[i]={key:c.key,xOff:0,yOff:0,xPos:s?c.xPos:f,yPos:s?f:c.yPos,isXNeg:!s&&n.isNegative,isYNeg:s&&n.isNegative}}n.origin=f}),e}function O(e){if(h)return e;var t="is"+o.toUpperCase()+"Neg",n=function(n,r,i,s){var u=Object.keys(n).reduce(function(e,t){return e[t]=n[t],e},{});u[o+"Pos"]=l(0);var a=0,f;for(f=i-1;f>=0;f--)if(e[f].values[r]&&e[f].values[r][t]===s){a=e[f].values[r][o+"Off"],a-=l(0)-e[f].values[r][o+"Pos"];break}return u[o+"Off"]=a,u.datapoint=null,u};return e.map(function(e,r){return{values:e.values.map(function(e,i){return e[t]?e:n(e,i,r,!0)}),key:"Negative~"+e.key,isNegative:!0}}).concat(e.map(function(e,r){return{values:e.values.map(function(e,i){return e[t]?n(e,i,r,!1):e}),key:"Positive~"+e.key,isNegative:!1}}))}function M(e,n,r){return e.forEach(function(e){e.values.forEach(function(e){e.datapoint&&(e.styles=t.calculateStyles(e.datapoint,n,r))})}),A(O(e)).map(function(e){var t=e.values.map(function(t){return L(t,e.origin)});return{key:e.key,subgroupKey:e.subgroupKey,values:e.values,line:t}})}function _(e,t){return t?e.filter(function(e){return e.values.some(function(e){return e.datapoint?t.indexOf(e.datapoint.id)!==-1:!1})}):e}function D(e){var t=e.selectAll("stop");C(t)}function P(t,n,i){function a(e){if(e.values.length<=1)return[];var t=[],n=e.values[0][u+"Pos"],r=e.values[e.values.length-1][u+"Pos"],i=f.rangeBand()/(r-n);return e.values.forEach(function(s,o){var a=s[u+"Pos"],f=(a-n)/(r-n);s.datapoint?(t.push({layoutpoint:s,offset:f-.4*i}),t.push({layoutpoint:s,offset:f+.4*i})):o!==e.values.length-1&&(e.values.slice(0,o).reverse().some(function(e){if(e.datapoint)return t.push({layoutpoint:e,offset:f}),!0}),e.values.slice(o).some(function(e){if(e.datapoint)return t.push({layoutpoint:e,offset:f}),!0}))}),t}var o=n.selectAll(".lineargradient").data(t,function(e){return m(e,i)});o.enter().append("linearGradient").attr("class","lineargradient"),o.attr("id",function(e){return m(e,i)}).attr("y2",function(){return s?0:1}).attr("x2",function(){return s?1:0}),r.transition.cancel(o);var l=o.selectAll("stop").data(a);l.enter().append("stop").style("stop-color",e.DEFAULT_COLOR).style("stop-opacity",1e-6),C(l),r.transition(l.exit()).always().remove(),r.transition(o.exit()).always().remove()}function H(e){var n=function(e){var n=[{x:0,y:0,width:i.canvasWidth(),height:i.canvasHeight(),visible:!0}];return e.values.reduce(function(e,r){var o=!e.datapoint||t.visible(e),u=!r.datapoint||t.visible(r);return(!o||!u)&&n.push({x:s?e.xPos-1:0,y:s?0:e.yPos-1,width:s?r.xPos-e.xPos+2:i.canvasWidth(),height:s?i.canvasHeight():r.yPos-e.yPos+2}),r}),n},r=e.selectAll("rect").data(n);r.enter().append("rect"),r.style("fill",function(e){return e.visible?"#ffffff":"#000000"}).attr("x",function(e){return e.x}).attr("y",function(e){return e.y}).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}),r.exit().remove()}function B(e,t,n){var i=t.selectAll("mask").data(e,function(e){return g(e,n)});i.enter().append("mask").attr("id",function(e){return g(e,n)}),H(i),r.transition(i.exit()).always().remove()}function j(e,t,n){var r=[];e.each(function(e){r.push(e)}),P(r,t,n),B(r,t,n)}function F(e,t){var n=_(e.selectAll(".lineargradient"),t);D(n);var r=_(e.selectAll("mask"),t);H(r)}function I(e,n,r,i){e.each(function(e){e.values.forEach(function(e){e.datapoint&&(!i||i.indexOf(e.datapoint.id)!==-1)&&(e.styles=t.calculateStyles(e.datapoint,n,r))})})}function q(e,t){var n=[];return typeof e=="function"&&t.each(function(t){t.values.forEach(function(t){t.datapoint&&e(t.datapoint)&&n.push(t.datapoint.id)})}),typeof e=="function"?n:e}function R(e){return e.selectAll("path").data(function(e){return[e]},function(e){return e.key})}function U(t,n){var i=R(t);i.enter().append("path").attr("class","rendering").style("fill",e.DEFAULT_COLOR).style("stroke",e.DEFAULT_COLOR).style("stroke-width","0px").style("stroke-opacity",1e-6).style("fill-opacity",1e-6);var s=function(e){return"url(#"+m(e,n)+")"},o=function(e){return"url(#"+g(e,n)+")"};i.style("mask",o).style("stroke",s).style("fill",s).style("stroke-linejoin","round"),r.transition(i.exit()).fadeToRemove();var u=r.transition(i);u.highDetail().call(T),u.lowDetail().call(N)}function z(e,t,n){j(e,t,n),U(e,n)}function W(e,t,n,r,i){var s=q(i,e),o=_(e.selectAll("path.rendering"),s);I(o,n,r,s),F(t,s)}var s=i.isOrdinal(i.coordinates.scaleX())&&i.coordinates.scaleX().domain().length>1,o=s?"y":"x",u=s?"x":"y",a=i.coordinates[s?"scaleY":"scaleX"](),f=i.coordinates[s?"scaleX":"scaleY"](),l=function(e){return i.coordinates.position(s?[undefined,e]:[e,undefined])[o]},c=function(e){return i.coordinates.position(s?[e,undefined]:[undefined,e])[u]},h=i.isCategorical(a),p=(s?1:-1)*(h?a.rangeBand()/2:0),d=h?a.rangeBand()*e.DEFAULT_CHANNEL_FILL_PERCENT:0,v=function(e,t,n){var r=e+t.key+"-"+t.subgroupKey+"-"+n;return r.replace(/[\x00-\x2C\x3B-\x40\x5B-\x5E\x7B-\x7D]+/g,"")},m=function(e,t){return v("Gradient-",e,t)},g=function(e,t){return v("Mask-",e,t)},y=d3.svg.area().x0(function(e){return e.x!==undefined?e.x:e.x0}).x1(function(e){return e.x!==undefined?e.x:e.x1}).y0(function(e){return e.y!==undefined?e.y:e.y0}).y1(function(e){return e.y!==undefined?e.y:e.y1}).interpolate(i.rounded?"cardinal":"linear");return{createLayout:k,createLineGroups:M,order:function(){},render:z,update:W}}}),define("mark/customPath",["./constants","./sizer","./styles","../layout","../utility"],function(e,t,n,r,i){var s={segType:"L",path:[[-1,-0.8],[-0.8,-1],[0,-0.2],[.8,-1],[1,-0.8],[.2,0],[1,.8],[.8,1],[0,.2],[-0.8,1],[-1,.8],[-0.2,0]]},o={segType:"L",path:[[0,-1],[-1,1],[1,1]]},u={segType:"L",path:[[1,-1],[-1,-1],[-1,1],[1,1]]},a={segType:"L",path:[[0,-1],[1,0],[0,1],[-1,0]]},f={segType:"L",path:[[-0.2,-0.2],[-0.2,-1],[.2,-1],[.2,-0.2],[1,-0.2],[1,.2],[.2,.2],[.2,1],[-0.2,1],[-0.2,.2],[-1,.2],[-1,-0.2]]},l={segType:"A",flags:[0,1,1],path:[[.1,-1],[-0.1,-1]]};return function(c,h,p){function v(){switch(c.shape){case"triangle":return o;case"square":return u;case"diamond":return a;case"plus":return f;case"circle":return l;case"x":return s}return s}function g(){return undefined}function y(e){return e.style("fill",n.color).style("fill-opacity",n.opacity).style("stroke",n.borderColor).style("stroke-opacity",n.borderOpacity).style("stroke-width",n.borderWidth)}function b(e){return e}function w(e){return"M"+m.path.map(function(t,n){var r=t[0]*e+","+t[1]*e;return n&&m.segType.toLowerCase()==="a"?[e,e].concat(m.flags,[r]).join(","):r}).join(m.segType)+"Z"}function E(e){return e.selectAll("path.rendering").data(function(e){return[e]},function(e){return e.datapoint.id})}function S(e){var t=E(e),n=i.transition(t);n.lowDetail().call(y),n.highDetail().call(b)}function x(e){i.transition(e.selectAll(".rendering:not(path):not(.custom-path)")).fadeToRemove();var t=E(e),n=e.selectAll("circle.rendering.custom-path").data(function(e){return[e]},function(e){return e.datapoint.id});c.shape?(t.enter().append("path").attr("class","rendering custom-path").style("pointer-events","none"),t.attr("d",function(e){return w(d.pointMarkRadius(e))}),i.transition.cancel(t),y(t)):t.remove(),n.enter().append("circle").attr("class","rendering custom-path").attr("r",10).style("visibility","hidden").style("pointer-events","all"),i.transition.cancel(n)}function T(e){return x}function N(e){e.attr("x",0).attr("y",function(e){return-d.lineSize(e)-3})}var d=t(c),m=v();return{layoutInfo:r.standard.bind(null,c,{sizeMultiplier:e.DEFAULT_CHANNEL_FILL_PERCENT,defaultStackDirection:h,useSeriesKey:p}),sort:g,renderer:T,update:S,positionLabels:N,id:"custom-path"}}}),define("mark/arcbar",["./constants","./styles","../layout","../utility","../config"],function(e,t,n,r,i){function a(e){function f(e,t){return function(n){var r=this[e]?this[e].angle:0,i=this.parentNode._current;this.parentNode._current&&this.parentNode._current.angle===n.angle&&(r=n.angle);var s=d3.interpolateNumber(r,n.angle);return this[e]=n,function(e){return t(n.radius,s(e))}}}function l(){return f("_currentForArc",function(e,t){return a({radius:e,angle:t})})}function c(){return f("_currentForTransform",function(t,n){var r=e.coordinates.center(),i=e.coordinates.position(t,n);return"translate("+(-i.x+r.x)+", "+(-i.y+r.y)+")"})}function h(){var t;return e.viewmode==="comparison"&&(t=n.basicPolar().groupKey(e.groupByCell).xPosition(function(t){return e.coordinates.position([t.x,t.y]).x}).yPosition(function(t){return e.coordinates.position([t.x,t.y]).y}).radius(function(t){return e.coordinates.radius(t.x)}).angle(function(t){return e.coordinates.angle(t.y)}).layout(e.datapoints)),t}function p(e){return e.selectAll("path").data(function(e){return[e]})}function d(e){var t=e.append("path").attr("class","rendering arcbar");return t.append("title"),t}function v(){if(e.viewmode==="comparison")return r.order.positionAndSizeComparator}function m(e){e.attr("dy","-0.5em")}function g(n){var i=p(n),s=d(i.enter()).style("fill",t.color).style("fill-opacity",1e-6).style("stroke-opacity",1e-6);i.select("title").text(e.tooltip);var o=r.transition(n.activeTransition.highDetail().selectAll("path.rendering"));o.lowDetail().style("fill",t.color).style("fill-opacity",t.opacity).style("stroke",t.stroke).style("stroke-opacity",t.strokeOpacity).style("stroke-width",t.strokeWidth),o.highDetail().attrTween("transform",c()).attrTween("d",l())}function y(e){return!e.empty()&&!e.classed("arcbar")&&r.transition(e.selectAll(".rendering")).fadeToRemove(),g}function b(e){}var i=s;e.isCategorical(e.coordinates.scaleRadius())&&(i=e.coordinates.scaleRadius().rangeBand()-o*2,i<o*2&&(i=e.coordinates.scaleRadius().rangeBand()*u));var a=d3.svg.arc().innerRadius(function(e){return e.radius-i*.5}).outerRadius(function(e){return e.radius+i*.5}).startAngle(0).endAngle(function(e){return e.angle});return{layoutInfo:h,sort:v,renderer:y,update:b,positionLabels:m,id:"arcbar"}}var s=15,o=5,u=.6;return a}),define("mark/network/chord",["../constants","../styler","../../config","../../utility"],function(e,t,n,r){return function(i){function u(t){var u,a,f=i.canvasWidth(),l=i.canvasHeight(),c=Math.min(f,l)*s,h=c+25,p=d3.svg.arc().innerRadius(c).outerRadius(h),d=d3.svg.chord().radius(c),v=function(e){return d3.interpolateObject({startAngle:Math.PI*2,endAngle:Math.PI*2},e)},m=function(e,t){return d3.interpolateObject(e,t)},g=function(e){var t=v(e);return this._current=e,function(e){return p(t(e))}},y=function(e){var t=m(this._current,e);return this._current=e,function(e){return p(t(e))}},b=function(e){if(e.source.index>e.target.index){var t=e.source;e.source=e.target,e.target=t}},w=function(e){b(e);var t=v(e.source),n=v(e.target);return this._current=e,function(e){return d({source:t(e),target:n(e)})}},E=function(e){b(e);var t=m(this._current.source,e.source),n=m(this._current.target,e.target);return this._current=e,function(e){return d({source:t(e),target:n(e)})}},S=function(e){var t=d3.scale.linear().domain([0,e.value]).nice(),n=(e.endAngle-e.startAngle)/t.domain()[1];return t.ticks(20).map(function(t,r){return{angle:t*n+e.startAngle,value:t,label:r%5?null:d3.format("s")(t)}})},x=function(e,t,n){var r=function(e){return e.source.index!==n&&e.target.index!==n};t.style("stroke-opacity",function(t){return e&&r(t)?"0.1":o.strokeOpacity(t)}).style("fill-opacity",function(t){return e&&r(t)?.1:o.fillOpacity(t)})},T=function(){var e=0,t={},n=[];i.datapoints.forEach(function(r){t.hasOwnProperty(r.id())||(n[e]=r.id(),t[r.id()]=e++)});var r=[];i.edges.forEach(function(e){var i=t[e.fromId()],s=t[e.toId()];r[i]===undefined&&(r[i]=[],n.forEach(function(){r[i].push(0)})),r[i][s]=e.value()}),u=d3.layout.chord().padding(.05).matrix(r)},N=function(){t.selectAll(".cell:not(.chorddiagram)").remove(),t.selectAll("rect.background").data(["background"]).enter().append("rect").attr("class","background").attr("visibility","hidden").attr("pointer-events","all").attr("height",l).attr("width",f).on("mouseover",function(){x(!1,d3.selectAll(".chord"))}),a=t.selectAll(".cell").data(["chord"]),a.enter().append("g").attr("class","cell chorddiagram specialmode").attr("transform","translate("+f/2+", "+l/2+")").append("circle").attr("r",c).style("visibility","hidden").style("pointer-events","all")},C=function(){var t=a.selectAll("g.group").data(u.groups);r.transition(t.exit()).fadeToRemove();var s=r.transition(t.select("path.chordgroup"),n.transition.duration()*2);s.lowDetail().style("fill",function(e){return o.fill(i.datapoints[e.index])}).style("stroke",function(e){return o.stroke(i.datapoints[e.index])}),s.always().attrTween("d",y);var f=t.enter().append("g").attr("class","group"),l=f.append("path").attr("id",function(e,t){return"chordgroup"+t}).attr("class","rendering chordgroup").style("fill",e.DEFAULT_COLOR).style("stroke",d3.rgb(e.DEFAULT_COLOR).darker().toString()).on("mouseover",function(e){x(!0,d3.selectAll(".chord"),e.index)});s=r.transition(l,n.transition.duration()*2),s.lowDetail().style("fill",function(e){return o.fill(i.datapoints[e.index])}).style("stroke",function(e){return o.stroke(i.datapoints[e.index])}),s.always().attrTween("d",g),l.append("title"),t.select("title").text(function(e){return i.datapoints[e.index].value()});var c=f.append("text").attr("class","chordgrouplabel").attr("dx",10).attr("dy",18).attr("opacity",1e-6);c.append("textPath").attr("class","chordgrouplabel-textpath").attr("xlink:href",function(e,t){return"#chordgroup"+t}),r.transition(t.selectAll(".chordgrouplabel"),n.transition.duration()*2).lowDetail().attr("opacity",function(){return i.hasLabel?1:1e-6});var p=t.select(".chordgrouplabel-textpath").text(function(e){return i.datapoints[e.index].value()});r.transition(t.select(".chordgrouplabel-textpath"),n.transition.duration()*2).always().attrTween("xlink:href",function(e,t){return function(){return"#chordgroup"+t}}),f.append("g").attr("class","ticks ticklabels");var d=t.select("g.ticks").selectAll("g").data(S,function(e){return e.value}),v=function(e){return"rotate("+(e.angle*180/Math.PI-90)+")"+" translate("+h+", 0)"},m=d.enter().append("g").attr("transform",v).attr("opacity",1e-6);m.append("line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).style("stroke","#000"),m.append("text").attr("x",8).attr("dy",".35em").text(function(e){return e.label}),d.selectAll("text").attr("text-anchor",function(e){return e.angle>Math.PI?"end":null}).attr("transform",function(e){return e.angle>Math.PI?"rotate(180) translate(-16)":null}),s=r.transition(d,n.transition.duration()*2),s.always().attrTween("transform",function(e,t,n){return d3.interpolateString(n,v(e))}).attr("opacity",function(){return i.hasLabel?1:1e-6}),r.transition(d.exit()).fadeToRemove()},k=function(){var t=a.selectAll("path.chord").data(u.chords),s=r.transition(t,n.transition.duration()*2);s.lowDetail().style("fill",function(e){return o.fill(i.datapoints[e.source.index])}).style("stroke",function(e){return o.stroke(i.datapoints[e.source.index])}),s.always().attrTween("d",E);var f=t.enter().append("path").attr("class","rendering chord").style("fill",e.DEFAULT_COLOR).style("stroke",d3.rgb(e.DEFAULT_COLOR).darker().toString());f.append("title"),t.select("title").text(function(e){return"From: "+i.datapoints[e.source.index].value()+" ("+e.source.value+") \n"+"To: "+i.datapoints[e.target.index].value()+" ("+e.target.value+")"}),s=r.transition(f,n.transition.duration()*2),s.lowDetail().style("fill",function(e){return o.fill(i.datapoints[e.source.index])}).style("stroke",function(e){return o.stroke(i.datapoints[e.source.index])}),s.always().attrTween("d",w),r.transition(t.exit()).fadeToRemove()};T(),N(),C(),k()}var s=.4,o=t(i);return{render:u}}}),define("mark/plotter",["../config","../utility","./centroidPlot","./linePlot","./hex","./dot","./pie","./text","./bar","./tile","./lineStub","./line","./area","./customPath","./arcbar","./network/chord"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return function(e){function g(){if(m==="dot")return e.viewmode==="part-to-whole-stack"?o:s;if(m==="text")return u;if(m==="bar")return e.coordinates.type==="rectangular"?a:d;if(m==="tile")return f;throw"Unsupported mark type: "+m}function y(){if(!e.datapoints||e.datapoints.length===0)return[];if(m==="dot"||m==="text"||m==="bar"||m==="tile"){var t=g();return[{plot:n(t,e),id:t===o?"pie":"centroid"}]}if(m==="line"){var s=e.isOrdinal(e.coordinates.scaleX())&&e.coordinates.scaleX().domain().length>1,u=e.isOrdinal(e.coordinates.scaleY())&&e.coordinates.scaleY().domain().length>1,a=s||u,f=e.datapoints[0].seriesKey!==undefined,d=e.viewmode==="comparison"&&e.isQxQ()&&f;return a||d?[{plot:r(e.viewmode==="part-to-whole-stack"?h:c,e),id:"line"},{plot:n(p,e,s?"vertical":"horizontal",!0),id:"centroid"}]:[{plot:n(l,e),id:"centroid"},{plot:n(p,e),id:"centroid2"}]}if(m==="hex")return[{plot:i(e),id:"hex"}];if(m==="networkchord")return[{plot:v(e),id:"networkchord"}]}function b(e){var n=e.selectAll(".plot").data(y(),function(e){return e.id}),r=n.enter(),i=!r.empty();return r.append("g").attr("class","plot").attr("plotId",function(){return t.uuid("valplot-")}),i&&n.each(function(){this.parentNode.appendChild(this)}),n.exit().classed("plot",!1),t.transition(n.exit(),".rendering,.label").fadeToRemove(),n.each(function(t){t.plot.render(d3.select(this))}),n}function w(t,n){var r=t.selectAll(".plot");n&&!Array.isArray(n)&&typeof n!="function"&&(n=[n]),r.each(function(t){t.plot.update&&t.plot.update(d3.select(this),e.propertyOverrides,n)})}var m=e.markType;return{plot:b,update:w}}}),define("mark/renderer",["../config","../coordinates","../data/datapointSpec","../data/specMapper","./plotter","./renderState"],function(e,t,n,r,i,s){return function(o){function l(e){var n=t[o.coordinatesType]();n.center&&n.center([parseFloat(e.attr("width"))/2,parseFloat(e.attr("height"))/2]);var r=null,i=null;return o.scaleXOrig&&(r=o.scaleXOrig.copy(),r.type=o.scaleXOrig.type,r.canAdjust=o.scaleXOrig.canAdjust),o.scaleYOrig&&(i=o.scaleYOrig.copy(),i.type=o.scaleYOrig.type,i.canAdjust=o.scaleYOrig.canAdjust),n.scaleX(r),n.scaleY(i),n}function c(){var e=typeof o.canvasSelector=="string"?d3.select(o.canvasSelector):o.canvasSelector;return u.scaleX()||(o.scaleXOrig=d3.scale.ordinal().domain([null]).rangeBands([0,parseFloat(e.attr("width"))]),o.scaleXOrig.type="nominal"),u.scaleY()||(o.scaleYOrig=d3.scale.ordinal().domain([null]).rangeBands([parseFloat(e.attr("height")),0]),o.scaleYOrig.type="nominal"),e}o=o||{},o.datapoints=[],o.z=null,o.color=null,o.size=null,o.opacity=null,o.scale=1,o.hasLabel=!1,o.canvasSelector="#canvas",o.coordinatesType="rectangular",o.jitter="none",o.viewmode="comparison",o.events={},o.listeners={},o.propertyOverrides={},o.borderWidth=1,o.borderColor="darker",o.markType="dot",o.shape=null,o.rounded=!1,o.scaleXOrig=null,o.scaleYOrig=null;var u={},a=null,f=n;u.data=function(e){return arguments.length?(a=e,o.datapoints=[],u):a},u.fields=function(e){return arguments.length?(f=e,o.datapoints=[],u):f},u.coordinates=function(e){return arguments.length?(t.hasOwnProperty(e)&&(o.coordinatesType=e),u):o.coordinatesType},u.canvas=function(e){return arguments.length?(o.canvasSelector=e,u):o.canvasSelector},u.viewmode=function(e){return arguments.length?(o.viewmode=e,u):o.viewmode},u.scale=function(e){return arguments.length?(o.scale=e,u):o.scale},u.addLabel=function(e){return arguments.length?(o.hasLabel=e,u):o.hasLabel},u.size=function(e){return arguments.length?(o.size=e,u):o.size},u.color=function(e){return arguments.length?(o.color=e,u):o.color},u.opacity=function(e){return arguments.length?(o.opacity=e,u):o.opacity},u.z=function(e){return arguments.length?(o.z=e,u):o.z},u.scaleX=function(e,t,n){return arguments.length?(e&&(o.scaleXOrig=e,o.scaleXOrig.type=e.rangeBand?t?"ordinal":"nominal":"quantitative",o.scaleXOrig.canAdjust=n),u):o.scaleXOrig},u.scaleY=function(e,t,n){return arguments.length?(e&&(o.scaleYOrig=e,o.scaleYOrig.type=e.rangeBand?t?"ordinal":"nominal":"quantitative",o.scaleYOrig.canAdjust=n),u):o.scaleYOrig},o.tooltip=null,u.jitter=function(e){return arguments.length?(o.jitter=e,u):o.jitter},u.event=function(e,t){return o.events[e]=t,u},u.listen=function(e,t){return o.listeners[e]||(o.listeners[e]=[]),o.listeners[e].push(t),u},u.borderWidth=function(e){return arguments.length?(o.borderWidth=e,u):o.borderWidth},u.borderColor=function(e){return arguments.length?(o.borderColor=e,u):o.borderColor},u.markType=function(e){return arguments.length?(o.markType=e,u):o.markType},u.shape=function(e){return arguments.length?(o.shape=e,u):o.shape},u.rounded=function(e){return arguments.length?(o.rounded=!!e,u):o.rounded},u.tooltip=function(e){return arguments.length?(o.tooltip=e,u):o.tooltip},u.propertyOverride=function(e,t){return arguments.length===1&&(t=e),e===t||e==="all"?(o.propertyOverrides.point=t,o.propertyOverrides.series=t):o.propertyOverrides[e]=t,u},u.render=function(){o.canvas=c(),o.coordinates=l(o.canvas),o.notify("renderStart"),o.doRender(o.canvas),o.notify("renderEnd");var e=s();return o.coordinates.scaleX()&&e.xDomain(o.coordinates.scaleX().domain()),o.coordinates.scaleY()&&e.yDomain(o.coordinates.scaleY().domain()),e.exportState()},u.update=function(e){i(o).update(c(),e)},o.doRender=function(t){!o.datapoints.length&&a&&(o.datapoints=r.reify(f,a,n)),t.transition().duration(e.transition.duration()).each("start",function(){o.notify("transitionStart")}).each("end",function(){o.notify("transitionEnd")}),i(o).plot(t)},o.canvasWidth=function(){return parseFloat(o.canvas.attr("width"))},o.canvasHeight=function(){return parseFloat(o.canvas.attr("height"))},o.isQuantitative=function(e){return e&&e.type==="quantitative"},o.isCategorical=function(e){return e&&(e.type==="nominal"||e.type==="ordinal")},o.isOrdinal=function(e){return e&&e.type==="ordinal"},o.isNominal=function(e){return e&&e.type==="nominal"},o.isEmpty=function(e){return o.isCategorical(e)&&e.domain().length===1&&e.domain()[0]===null},o.isQxQ=function(){return o.isQuantitative(o.coordinates.scaleX())&&o.isQuantitative(o.coordinates.scaleY())},o.groupByCell=function(e){return(o.isCategorical(o.coordinates.scaleX())&&!o.isEmpty(o.coordinates.scaleX())?e.x:"null")+";"+(o.isCategorical(o.coordinates.scaleY())&&!o.isEmpty(o.coordinates.scaleY())?e.y:"null")};var h=function(e,t){return function(n){if(n.target.className.baseVal.indexOf(e)===-1||!n.target.__data__)return;n.datapoint=n.target.__data__.datapoint,t(n)}};return o.bindEvents=function(e){var t=o.canvas.node(),n;for(n in o.events)if(o.events.hasOwnProperty(n)){var r="__val_on"+n,i=t[r];i&&t.removeEventListener(n,i);var s=h(e,o.events[n]);t[r]=s,t.addEventListener(n,s)}},o.notify=function(e){o.listeners.hasOwnProperty(e)&&o.listeners[e].forEach(function(e){setTimeout(e,0)})},u}}),define("data/edgeSpec",[],function(){return{fromId:"fromId",toId:"toId",value:"value",color:"color",size:"size",opacity:"opacity",label:"label"}}),define("mark/network/networkrenderer",["../renderer","../../data/edgeSpec","../../data/specMapper"],function(e,t,n){return function(r){r=r||{};var i=e(r);r.edges=[],r.edgeColor=null,r.edgeSize=null,r.edgeOpacity=null;var s=null,o=t;return i.edges=function(e){return arguments.length?(s=e.slice(0),r.edges=[],i):s},i.edgeFields=function(e){return arguments.length?(o=e,r.edges=[],i):o},i.edgeSize=function(e){return arguments.length?(r.edgeSize=e,i):r.edgeSize},i.edgeColor=function(e){return arguments.length?(r.edgeColor=e,i):r.edgeColor},i.edgeOpacity=function(e){return arguments.length?(r.edgeOpacity=e,i):r.edgeOpacity},i.render=function(){r.notify("renderStart"),!r.edges.length&&s&&(r.edges=n.reify(o,s,t)),r.doRender(),r.notify("renderEnd")},i}}),define("reference/line/base",[],function(){return function(e){e=e||{};var t={};return t.xScale=function(t){return arguments.length?(e.xScale=t,this):e.xScale},t.yScale=function(t){return arguments.length?(e.yScale=t,this):e.yScale},t.data=function(t){return arguments.length?(e.data=t,this):e.data},t.lineClass=function(t){return arguments.length?(e.lineClass=t,this):e.lineClass},t}}),define("reference/line/horizontal",["./base","../../config"],function(e,t){return function(n){n=n||{},n.lineClass="val-horizontal-reference";var r=e(n);return r.render=function(e){var r=e.selectAll("line.val-horizontal-reference."+n.lineClass).data(n.data||[]);r.enter().append("line").attr("class","val-horizontal-reference "+n.lineClass).attr("y1",0).attr("y2",0).style("stroke-opacity",1),r.attr("x1",n.left).attr("x2",n.right),n.yScale&&r.transition().duration(t.transition.duration()).attr("y1",n.yScale).attr("y2",n.yScale),r.exit().transition().duration(t.transition.duration()).style("stroke-opacity",1e-6).remove()},r.left=function(e){return arguments.length?(n.left=e,this):n.left},r.right=function(e){return arguments.length?(n.right=e,this):n.right},r}}),define("reference/line/vertical",["./base","../../config"],function(e,t){return function(n){n=n||{},n.lineClass="val-vertical-reference";var r=e(n);return r.render=function(e){var r=e.selectAll("line.val-vertical-reference."+n.lineClass).data(n.data||[]);r.enter().append("line").attr("class","val-vertical-reference "+n.lineClass).attr("x1",0).attr("x2",0).style("stroke-opacity",1),r.attr("y1",n.top).attr("y2",n.bottom),n.xScale&&r.transition().duration(t.transition.duration()).attr("x1",n.xScale).attr("x2",n.xScale),r.exit().transition().duration(t.transition.duration()).style("stroke-opacity",1e-6).remove()},r.top=function(e){return arguments.length?(n.top=e,this):n.top},r.bottom=function(e){return arguments.length?(n.bottom=e,this):n.bottom},r}}),define("reference/line/linear",["../../utility"],function(e){return function(t){t=t||{},t.id=e.uuid("val-linear-reference-"),t.lineClass="",t.slope=0,t.intercept=0,t.color=null,t.width=null;var n={};return n.id=function(e){return arguments.length?(t.id=e,n):t.id},n.xScale=function(e){return arguments.length?(t.xScale=e,n):t.xScale},n.yScale=function(e){return arguments.length?(t.yScale=e,n):t.yScale},n.slope=function(e){return arguments.length?(t.slope=e,n):t.slope},n.yIntercept=function(e){return arguments.length?(t.intercept=e,n):t.intercept},n.xRange=function(e){return arguments.length?(t.xRange=e,n):t.xRange},n.lineClass=function(e){return arguments.length?(t.lineClass=e,n):t.lineClass},n.color=function(e){return arguments.length?(t.color=e,n):t.color},n.width=function(e){return arguments.length?(t.width=e,n):t.width},n.render=function(e){var r=t.slope===0?1e-6:t.slope,i=t.xRange?t.xRange[0]:t.xScale.domain()[0],s=r*i+t.intercept,o=t.xRange?t.xRange[1]:t.xScale.domain()[1],u=r*o+t.intercept;return n.remove(e),e.append("svg:line").attr("id",t.id).attr("class","val-linear-reference "+t.lineClass).attr("x1",t.xScale(i)).attr("y1",t.yScale(s)).attr("x2",t.xScale(o)).attr("y2",t.yScale(u)).style("stroke",function(){return t.color||(window.getComputedStyle(this).getPropertyValue("stroke")==="none"?"black":null)}).style("stroke-width",function(){return t.width||null}),n},n.remove=function(e){e.selectAll("#"+t.id).remove()},n}}),define("reference/line",["./line/horizontal","./line/vertical","./line/linear"],function(e,t,n){return{horizontal:e,vertical:t,linear:n}}),define("reference/axis/axis",["../line","../../config"],function(e,t){return function(){function p(){var e=n.scale().range();return Math.abs(e[0]-e[e.length-1])}function d(){n.ticks(h.defaultTicks()),n.tickSubdivide(h.defaultSubdivide())}function v(){return c&&n.scale().rangeBand}function m(){s&&d(),v()?n.tickSize(0,o):n.tickSize(o,u,a),n.tickValues(f);if(l!==null){var e=typeof l=="function"?l:d3.format(l);n.tickFormat(e)}}function g(e){if(!r||r==="")return;var t,i;if(n.orient()==="bottom")t="translate(0, 30)",i="";else{if(n.orient()!=="left")return;var s=n.scale(),o=s.domain()[0];t="translate(-30, "+s(o)+")",i="rotate(-90, 0, 0)"}e.append("text").style("fill","black").style("stroke","none").style("font-weight","Bold").attr("transform",t+" "+i).text(r),e.selectAll("text.hidden").style("opacity",1).each("end",function(){d3.select(this).classed("hidden",!1)})}function y(t){var r=h.orient(),i;if(r==="top")i=e.vertical().top(-o).bottom(0).xScale(n.scale());else if(r==="bottom")i=e.vertical().top(0).bottom(o).xScale(n.scale());else if(r==="left")i=e.horizontal().left(-o).right(0).yScale(n.scale());else{if(r!=="right")return;i=e.horizontal().left(0).right(o).yScale(n.scale())}i.lineClass("val-channel-tick"),v()&&o&&i.data(f||n.scale().domain()),i.render(t)}function b(e){var t=e.selectAll("text"),r=n.scale().domain();t.classed("val-start-tick",function(e,t){return e===r[0]}),t.classed("val-end-tick",function(e,t){return e===r[r.length-1]})}var n=d3.svg.axis(),r=null,i=!1,s=!0,o=n.tickSize(),u=0,a=0,f=null,l=null,c=!0,h={};return h.defaultTicks=function(e){return e=e||p(),Math.floor(e/48)},h.defaultSubdivide=function(e){return e=e||p(),e>=733?4:e>=349?1:0},h.scale=function(e){return arguments.length?(n.scale(e),i=!!e,h):n.scale()},h.orient=function(e){return arguments.length?(n.orient(e),h):n.orient()},h.ticks=function(e){return arguments.length?(n.ticks(e),s=!1,h):n.ticks()},h.tickSize=function(e,t,n){return arguments.length?(o=e,u=t||0,a=n||0,h):o},h.tickSubdivide=function(e){return arguments.length?(n.tickSubdivide(e),s=!1,h):n.tickSubdivide()},h.tickValues=function(e){return arguments.length?(f=e,h):f},h.tickFormat=function(e){return arguments.length?(l=e,h):l},h.drawChannelTicks=function(e){return arguments.length?(c=e,h):c},h.label=function(e){return arguments.length?(r=e,h):r},h.render=function(e){if(i){m();if(e.selectAll("path.domain").empty()){var r=n.scale(),s=r.range(),o=r.copy().range([s[0],s[0]]);n.scale(o),e.style("opacity",0).call(n),n.scale(r)}e.transition().duration(t.transition.duration()).style("opacity",1).call(n),b(e),g(e),y(e)}else e.selectAll("*").attr("opacity",1).transition().duration(t.transition.duration()).attr("opacity",1e-6).style("stroke-opacity","1e-6").remove()},h}}),define("reference/layerer",[],function(){return function(e){e=e||{},e.layerClass="val-layer",e.layers=[];var t={};return t.xScale=function(t){return arguments.length?(e.xScale=t,this):e.xScale},t.yScale=function(t){return arguments.length?(e.yScale=t,this):e.yScale},t.layerClass=function(t){return arguments.length?(e.layerClass=t,this):e.layerClass},t.insertBefore=function(t){return arguments.length?(e.insertBefore=t,this):e.insertBefore},t.add=function(t){return e.layers.push(t),t},t.render=function(t){var n=t.select("g."+e.layerClass);n.empty()&&(n=t.insert("g",e.insertBefore).attr("class",e.layerClass)),e.layers.forEach(function(t){t.xScale(e.xScale).yScale(e.yScale).render(n)})},t}}),define("reference/legend/base",[],function(){return function(e){e=e||{};var t={};return t.scale=function(n){return arguments.length?(e.scale=n,t):e.scale},t.data=function(n){return arguments.length?(e.data=n,t):e.data},t.legendClass=function(n){return arguments.length?(e.legendClass=n,t):e.legendClass},t}}),define("reference/legend/colors",["./base","../../config"],function(e,t){return function(){var n=5,r={},i=e(r);return r.legendClass="val-colors-legend",r.swatchDimensions=[20,20],i.swatchSize=function(e){return arguments?(r.swatchDimensions=e,i):r.swatchDimensions},i.render=function(e){var i=e.selectAll("g.val-colors-legend."+r.legendClass).data(r.data||[],function(e){return e}),s=i.enter().append("g").attr("class","val-colors-legend").attr("opacity",1e-6).style("fill-opacity",1e-6).style("stroke-opacity",1e-6);s.append("rect").attr("width",r.swatchDimensions[0]).attr("height",r.swatchDimensions[1]).style("fill",function(e){return r.scale(e)}).style("stroke",function(e){return d3.rgb(r.scale(e)).darker()}).style("stroke-width",2).style("shape-rendering","crispEdges"),s.append("text").attr("x",r.swatchDimensions[0]+n).attr("y",r.swatchDimensions[1]/2).attr("dy","0.4em").style("font-weight","bold").text(function(e){return e}),i.transition().duration(t.transition.duration()).attr("opacity",1).style("fill-opacity",1).style("stroke-opacity",1).attr("transform",function(e,t){return"translate(0.5, "+t*(r.swatchDimensions[1]+n)+")"}),i.exit().transition().duration(t.transition.duration()).attr("opacity",1e-6).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},i}}),define("reference/legend",["./legend/colors"],function(e){return{colors:e}}),define("reference",["./reference/axis/axis","./reference/layerer","./reference/legend","./reference/line"],function(e,t,n,r){return{axis:e,layerer:t,legend:n,line:r}}),define("colors/blue",[],function(){return function(){return d3.scale.ordinal().range(["#023858","#045A8D","#0570B0","#3690C0","#74A9CF","#A6BDDB","#D0D1E6","#ECE7F2","#FFF7FB"])}}),define("colors/gradient",[],function(){return function(e,t){return d3.scale.linear().interpolate(d3.interpolateRgb).range([e,t])}}),define("colors/sap",[],function(){return function(){return d3.scale.ordinal().range(["#3a95b3","#b6d949","#fdd36c","#f47958","#a65084","#0063b1","#748cb2","#9cc677","#eacf5e","#f9ad79","#d16a7c","#8873a2","#0da841","#fcb71d","#f05620","#b22d6e","#3c368e","#8fb2cf","#95d4ab","#eae98f","#f9be92","#ec9a99","#bc98bd","#1eb7b2","#73c03c","#f48323","#eb271b","#d9b5ca","#aed1da","#dfecb2","#fcdab0","#f5bcb4"])}}),define("colors/hotcold",[],function(){return function(){return d3.scale.quantize().range(["#3261c2","#3288bd","#66c2a5","#abdda4","#e6f598","#ffffbf","#fee08b","#fdae61","#f46d43","#d53e4f"])}}),define("colors/categorical",[],function(){return function(e,t){var n=d3.scale.ordinal().range(e);return typeof t!="undefined"&&n.domain(t),n}}),define("colors/stepped",[],function(){return function(e,t){var n=d3.scale.quantile().range(e);return typeof t!="undefined"&&n.domain(t),n}}),define("colors",["./colors/blue","./colors/gradient","./colors/sap","./colors/hotcold","./colors/categorical","./colors/stepped"],function(e,t,n,r,i,s){return{categorical:i,stepped:s,gradient:t,blue:e,sap:n,hotcold:r}}),define("val",["./mark/renderer","./mark/network/networkrenderer","./reference","./colors","./coordinates","./config"],function(e,t,n,r,i,s){return{renderer:e,networkRenderer:t,reference:n,colors:r,coordinates:i,config:s}})